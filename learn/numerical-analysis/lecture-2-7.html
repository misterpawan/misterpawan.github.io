<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 2-7: Random Numbers - Full Course</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ntu: {
                            red: '#e11d48',
                            dark: '#0f172a',
                            code: '#282c34',
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'sans-serif'],
                        mono: ['Consolas', 'Monaco', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #334155;
        }

        .slide-card {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .slide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .slide-number {
            background: #f1f5f9;
            color: #64748b;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .code-container {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 0;
            background: #282c34;
            border-radius: 8px;
            overflow: hidden;
            margin: 1.5rem 0;
            min-height: 300px;
            border: 1px solid #e2e8f0;
        }

        @media (max-width: 1024px) {
            .code-container {
                grid-template-columns: 1fr;
            }
        }

        .code-editor {
            padding: 1rem;
            color: #abb2bf;
            font-size: 0.85rem;
            overflow-x: auto;
            border-right: 1px solid #3e4451;
            position: relative;
        }

        .output-panel {
            padding: 1rem;
            background: #21252b;
            color: #98c379;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            overflow-y: auto;
            max-height: 400px;
            position: relative;
        }

        .run-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e11d48;
            color: white;
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            z-index: 10;
            font-weight: bold;
            border: none;
            transition: background 0.2s;
        }

        .run-btn:hover {
            background: #be123c;
        }

        .math-box {
            background: #f1f5f9;
            border-left: 4px solid #e11d48;
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
            border-radius: 0 8px 8px 0;
        }

        .plot-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            min-height: 250px;
        }

        /* Teach Mode Styles */
        body.teach-mode {
            overflow: hidden;
            background: black;
        }

        body.teach-mode nav,
        body.teach-mode header,
        body.teach-mode footer,
        body.teach-mode .run-btn {
            display: none !important;
        }

        body.teach-mode main {
            max-width: none;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.teach-mode .slide-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
            padding: 4rem;
            z-index: 100;
            overflow-y: auto;
            align-content: center;
        }

        body.teach-mode .slide-card.active-slide {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .teach-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #e11d48;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .teach-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(225, 29, 72, 0.5);
        }

        body.teach-mode .teach-btn {
            display: none;
            /* Hide toggle button in presentation */
        }
    </style>
</head>

<body>
    <button onclick="toggleTeachMode()" class="teach-btn">
        <span>üë®‚Äçüè´</span> Teach Mode
    </button>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-xl text-slate-800">Numerical Analysis <span
                    class="text-ntu-red">2-7</span></span>
            <div class="hidden md:flex space-x-1 text-sm font-medium text-slate-600">
                <a href="#intro" class="px-3 py-1 hover:bg-gray-100 rounded">Intro</a>
                <a href="#lcg" class="px-3 py-1 hover:bg-gray-100 rounded">LCG</a>
                <a href="#bitwise" class="px-3 py-1 hover:bg-gray-100 rounded">Bitwise</a>
                <a href="#distributions" class="px-3 py-1 hover:bg-gray-100 rounded">Distributions</a>
                <a href="#monte-carlo" class="px-3 py-1 hover:bg-gray-100 rounded">Monte Carlo</a>
                <a href="#hands-on" class="px-3 py-1 bg-ntu-red text-white rounded shadow-sm">Hands On</a>
            </div>
        </div>
    </nav>

    <header class="pt-24 pb-16 text-center px-4 bg-gradient-to-b from-rose-50 to-transparent">
        <h1 class="text-5xl md:text-6xl font-extrabold text-slate-900 mb-6 tracking-tight">
            Random Numbers üé≤
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-8">
            "Anyone who considers arithmetical methods of producing random digits is, of course, in a state of sin." ‚Äî
            John von Neumann
        </p>
        <div class="flex justify-center gap-4 text-sm text-gray-500 font-mono">
            <span>Lecture 2-7</span>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 pb-20">

        <section id="intro" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">1. Old-Fashioned Randomness</h2>
                <span class="slide-number">Slide 1-5</span>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="font-bold text-lg mb-2">The Pencil Method</h3>
                    <p class="text-slate-600 mb-4">
                        A pencil with sides A, B, C, D. Useful for exams, but not for scientific computing!
                        It lacks speed and precision (not enough digits).
                    </p>

                    <h3 class="font-bold text-lg mb-2">Random Number Tables</h3>
                    <p class="text-slate-600 mb-4">
                        Before computers, people used books full of random digits. These tables taught us two
                        fundamental properties of pseudo-randomness:
                    </p>
                    <ul class="list-disc ml-5 text-slate-600 font-bold">
                        <li>You need a seed to start.</li>
                        <li>It relies on recursive operations.</li>
                    </ul>
                </div>

                <div class="bg-gray-100 p-6 rounded-lg text-center">
                    <h4 class="font-bold text-gray-700 mb-2">True vs Pseudo Generators</h4>
                    <p class="text-sm text-gray-600 mb-4 text-left">
                        <strong>True Random:</strong> Measures physical phenomena (thermal noise, photoelectric effect).
                        Essential for cryptography.<br><br>
                        <strong>Pseudo Random:</strong> Computational algorithms. Deterministic sequences determined by
                        a seed. <span class="text-ntu-red font-bold">Good enough for most scientific
                            work.</span>
                    </p>
                    <div class="text-6xl mt-4">üñ•Ô∏è vs üé≤</div>
                </div>
            </div>
        </section>

        <section id="lcg" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">2. Linear Congruential Generator (LCG)</h2>
                <span class="slide-number">Slide 7-11</span>
            </div>

            <p class="mb-4 text-lg">A classical algorithm. Simple, commonly used, but potentially dangerous.</p>

            <div class="math-box text-center text-xl">
                $$ R_{next} = (a \cdot R_{current} + c) \mod M $$
            </div>

            <p class="text-slate-600 mb-6">
                Where $a, c$ are scaling constants and $M$ is the modulus. The period is at most $M$. A "bad" selection
                of constants leads to terrible results!
            </p>

            <div class="mb-10">
                <h3 class="font-bold text-lg mb-2 border-l-4 border-red-500 pl-3">Example: A Bad LCG ($M=100$)</h3>
                <p class="text-sm text-gray-500 mb-2">Watch how quickly the sequence repeats (38, 22,
                    86...).</p>
                <div class="code-container">
                    <div class="code-editor">
                        <button class="run-btn" onclick="runLCG()">‚ñ∂ Run Code</button>
                        <pre><code class="language-python"># 1207-example-01.py
class rnd:
    def __init__(self, s = 1234):
        self.seed = s
        
    def gen(self):
        # a=32533521, c=2424, M=100
        self.seed = (32533521*self.seed + 2424) % 100
        return self.seed

r = rnd()
for i in range(30):
    print(r.gen(), end=' ')</code></pre>
                    </div>
                    <div id="out-lcg" class="output-panel">Click Run...</div>
                </div>
            </div>

            <div class="mb-10">
                <h3 class="font-bold text-lg mb-2 border-l-4 border-blue-500 pl-3">Example: Park-Miller RNG (Good)</h3>
                <p class="text-sm text-gray-500 mb-2">Uses $a=16807, c=0, M=2^{31}-1$. The period is almost
                    $2^{31}-1$.</p>
                <div class="code-container">
                    <div class="code-editor">
                        <button class="run-btn" onclick="runParkMiller()">‚ñ∂ Run Code</button>
                        <pre><code class="language-python"># 1207-example-01a.py
class rnd:
    def __init__(self, s = 1234):
        self.seed = s
        
    def gen(self):
        self.seed = (16807*self.seed) % (2**31-1)
        return self.seed

r = rnd()
for i in range(30):
    print(r.gen(), end=' ')</code></pre>
                    </div>
                    <div id="out-pm" class="output-panel">Click Run...</div>
                </div>
            </div>

            <div class="bg-red-50 p-4 rounded border border-red-100">
                <h4 class="font-bold text-red-800 mb-1">‚ö†Ô∏è The RANDU Disaster</h4>
                <p class="text-sm text-red-900">
                    IBM used $a=65539, M=2^{31}$ in the 1960s. It produces numbers that fall into just <strong>15
                        planes</strong> in 3D space! "Guaranteed to bring dismay."
                </p>
            </div>
        </section>

        <section id="bitwise" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">3. Bitwise Generators</h2>
                <span class="slide-number">Slide 19-27</span>
            </div>

            <p class="mb-4">Using XOR, SHIFT, and AND operations for speed and better randomness.</p>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-2 text-indigo-600">XORSHIFT Algorithm</h3>
                    <div class="math-box text-sm">
                        $x \leftarrow x \text{ xor } (x \gg a_1)$<br>
                        $x \leftarrow x \text{ xor } (x \ll a_2)$<br>
                        $x \leftarrow x \text{ xor } (x \gg a_3)$
                    </div>
                    <p class="text-sm text-slate-600">Good parameters (e.g., 21, 35, 4) give periods of
                        $2^{32}-1$.</p>

                    <div class="code-container">
                        <div class="code-editor">
                            <button class="run-btn" onclick="runXorShift()">‚ñ∂ Run</button>
                            <pre><code class="language-python"># 1207-example-02.py (XORSHIFT)
class rnd:
    def __init__(self, s=1234):
        self.seed = s
    def gen(self):
        self.seed ^= (self.seed >> 21)
        self.seed ^= (self.seed << 35)
        self.seed ^= (self.seed >> 4)
        return (self.seed & 0xffffffff)
# ...</code></pre>
                        </div>
                        <div id="out-xor" class="output-panel"></div>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg mb-2 text-indigo-600">Multiply With Carry (MWC)</h3>
                    <div class="math-box text-sm">
                        Uses 64-bit logic.<br>
                        $(x \& \text{mask}) \cdot a + (x \gg 32)$
                    </div>
                    <p class="text-sm text-slate-600">Takes lower 32 bits, scales them, adds upper 32 bits.
                    </p>

                    <div class="code-container">
                        <div class="code-editor">
                            <button class="run-btn" onclick="runMWC()">‚ñ∂ Run</button>
                            <pre><code class="language-python"># 1207-example-03.py (MWC)
class rnd:
    def __init__(self, s=1234):
        self.seed = s
    def gen(self):
        self.seed = (self.seed & 0xffffffff) \
          * 4294957665 + (self.seed>>32)
        return (self.seed & 0xffffffff)
# ...</code></pre>
                        </div>
                        <div id="out-mwc" class="output-panel"></div>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <h3 class="font-bold text-lg mb-2 text-indigo-800">Combined Generator (The Beast)</h3>
                <p class="text-sm mb-2">Combining XORSHIFT + MWC yields a massive period of $\approx
                    10^{37}$.</p>
                <div class="code-container h-48">
                    <div class="code-editor">
                        <button class="run-btn" onclick="runCombined()">‚ñ∂ Run Combined</button>
                        <pre><code class="language-python"># 1207-example-04 (1).py
class rnd:
    def __init__(self, s1=1234, s2=5678):
        self.s1, self.s2 = s1, s2
    def gen(self):        
        # XORSHIFT part
        self.s1 ^= (self.s1 >> 17); self.s1 ^= (self.s1 << 31); self.s1 ^= (self.s1 >> 8)
        # MWC part
        self.s2 = (self.s2 & 0xffffffff)*4294957665 + (self.s2>>32)
        return ((self.s1 ^ self.s2) & 0xffffffff)</code></pre>
                    </div>
                    <div id="out-comb" class="output-panel"></div>
                </div>
            </div>
        </section>

        <section id="distributions" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">4. Non-Uniform Distributions</h2>
                <span class="slide-number">Slide 30-50</span>
            </div>

            <p class="mb-4 text-lg">We start with a uniform distribution (flat). How do we get shapes like Gaussian or
                Exponential?</p>

            <div class="mb-8 p-4 bg-red-50 border border-red-100 rounded">
                <h4 class="font-bold text-red-700 mb-2">‚ùå The Wrong Way</h4>
                <p class="text-sm mb-2">Just plugging random numbers into $f(x)$ does <strong>not</strong> produce
                    distribution $f(x)$. Since $y=f(x)=x$, the output is just a replica of the input!</p>
                <div class="code-container m-0 h-40">
                    <div class="code-editor">
                        <button class="run-btn" onclick="runWrong()">‚ñ∂ Plot</button>
                        <pre><code class="language-python"># 1207-example-05.py
def f(x): return x
x = np.random.rand(100000)
data = f(x)
plt.hist(data) # Result: Flat!</code></pre>
                    </div>
                    <div id="plot-wrong" class="plot-container"></div>
                </div>
            </div>

        </section>

        <section id="dist-hitmiss" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">4a. Rejection Sampling</h2>
                <span class="slide-number">Slide 35</span>
            </div>

            <div class="mb-8">
                <h4 class="font-bold text-blue-700 mb-2">‚úÖ Method 1: Hit-or-Miss (Rejection Sampling)</h4>
                <p class="text-sm mb-2">Generate random $(x, y)$. Keep $x$ only if $y < f(x)$. Simple but
                        inefficient.</p>
                        <div class="code-container m-0 h-64">
                            <div class="code-editor">
                                <button class="run-btn" onclick="runHitMiss()">‚ñ∂ Run & Plot</button>
                                <pre><code class="language-python"># 1207-example-06.py
def f(x):
    return x - x**2 + x**3 - x**4 + np.sin(x*13.)/13.
    
x = np.random.rand(20000)
y = np.random.rand(20000)*0.45

# Python filter
data = x[y < f(x)] 
plt.hist(data, bins=50)</code></pre>
                            </div>
                            <div id="plot-hitmiss" class="plot-container"></div>
                        </div>
            </div>
        </section>

        <section id="dist-inverse" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">4b. Inverse Transform</h2>
                <span class="slide-number">Slide 40</span>
            </div>

            <div class="mb-8">
                <h4 class="font-bold text-green-700 mb-2">‚úÖ Method 2: Inverse Transform</h4>
                <div class="math-box text-sm">
                    Solve $x = W^{-1}(r)$. <br>
                    Example: Exponential Decay $f(x) = e^{-x}$. Cumulative $W(x) = 1 - e^{-x}$. <br>
                    Inverse: $x = -\ln(1-r)$.
                </div>
                <div class="code-container m-0 h-64">
                    <div class="code-editor">
                        <button class="run-btn" onclick="runInverse()">‚ñ∂ Run & Plot</button>
                        <pre><code class="language-python"># 1207-example-07.py
r = np.random.rand(10000)
data = -np.log(1. - r + r/np.exp(1.))

plt.hist(data, bins=50, color='y')</code></pre>
                    </div>
                    <div id="plot-inverse" class="plot-container"></div>
                </div>
            </div>
        </section>

        <section id="dist-gauss" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">4c. Gaussian Distributions</h2>
                <span class="slide-number">Slide 45-50</span>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-bold text-purple-700 mb-2">Gaussian: Box-Muller</h4>
                    <div class="math-box text-xs">
                        $x = \sqrt{-2\ln(r_1)} \cos(2\pi r_2)$<br>
                        $y = \sqrt{-2\ln(r_1)} \sin(2\pi r_2)$
                    </div>
                    <div class="code-container m-0">
                        <div class="code-editor">
                            <button class="run-btn" onclick="runBoxMuller()">‚ñ∂ Plot</button>
                            <pre><code class="language-python"># 1207-example-08.py
r1 = np.random.rand(10000)
r2 = np.random.rand(10000)
x = (-2.*np.log(r1))**0.5 * \
    np.cos(2.*np.pi*r2)
# ... plot x and y</code></pre>
                        </div>
                        <div id="plot-gauss" class="plot-container"></div>
                    </div>
                </div>
                <div>
                    <h4 class="font-bold text-purple-700 mb-2">Gaussian: CLT Summation</h4>
                    <p class="text-xs mb-2">Central Limit Theorem: Sum of uniform distributions $\to$ Gaussian.</p>
                    <div class="code-container m-0">
                        <div class="code-editor">
                            <button class="run-btn" onclick="runCLT()">‚ñ∂ Plot</button>
                            <pre><code class="language-python"># 1207-example-08a.py
r = np.random.rand(10000)
# Add 5 more random arrays
for _ in range(5):
    r += np.random.rand(10000)

plt.hist(r, bins=50)</code></pre>
                        </div>
                        <div id="plot-clt" class="plot-container"></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="monte-carlo" class="slide-card">
            <div class="slide-header">
                <h2 class="text-3xl font-bold text-slate-800">5. Monte Carlo Integration</h2>
                <span class="slide-number">Slide 52-55</span>
            </div>

            <p class="mb-4">Integration in high dimensions? Grid methods fail ($N^d$). Monte Carlo wins!</p>
            <div class="math-box text-center">
                $$ I \approx (b-a) \langle f \rangle = \frac{V}{N} \sum f(x_i) $$
            </div>

            <h3 class="font-bold text-lg mb-2">6D Integral Example</h3>
            <p class="text-sm text-slate-600 mb-2">Integrating $\sin(a) + \sin(2b) + \dots + \cos(3f)$ over a 6D
                hypercube.</p>

            <div class="code-container">
                <div class="code-editor">
                    <button class="run-btn" onclick="runMC()">‚ñ∂ Run Simulation</button>
                    <pre><code class="language-python"># 1207-example-09.py
def func(a, b, c, d, e, f):
    return np.sin(a)+np.sin(b*2.)+...

# Exact solution pre-calculated: 3.17426

# Random Sampling (Monte Carlo)
nsamples = 1000000
v = np.random.rand(nsamples, 6)
val = func(v[:,0], ..., v[:,5])
intf_rand = val.sum() / nsamples

# Grid Sampling (Boxes)
# 20^6 = 64 million calls!
# intf_boxes = ...</code></pre>
                </div>
                <div id="out-mc" class="output-panel">Click Run to compare MC vs Grid...</div>
            </div>
        </section>

        <section id="hands-on" class="slide-card bg-gradient-to-br from-red-50 to-orange-50 border-red-100">
            <h2 class="text-3xl font-bold text-red-900 mb-6 flex items-center gap-3">
                <span>üëê</span> Hands-On Session
            </h2>

            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="font-bold text-lg text-red-800 mb-2">Practice 1: Step Function</h3>
                    <p class="text-sm text-gray-600 mb-4">Generate distribution for:</p>
                    <div class="math-box text-xs bg-gray-50">
                        f(x) = 1 (0 < x <=1)<br>
                            f(x) = 2 (1 < x <=2)<br>
                                ...<br>
                                f(x) = 9 (8 < x <=9) </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <h3 class="font-bold text-lg text-orange-800 mb-2">Practice 2: Complex Model</h3>
                        <p class="text-sm text-gray-600 mb-4">Generate 10k events for the Higgs fit model:</p>
                        <div class="math-box text-xs bg-gray-50">
                            $$ f(x) = \text{Gaussian} + ax^2 + bx + c $$
                        </div>
                    </div>
                </div>
        </section>

    </main>

    <script>
        // --- Output Helper ---
        function printTo(id, text, append = true) {
            const el = document.getElementById(id);
            if (!append) el.innerHTML = '';
            el.innerHTML += text + '<br>';
            el.scrollTop = el.scrollHeight;
        }

        // --- Teach Mode Logic ---
        let isTeachMode = false;
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide-card');

        function toggleTeachMode() {
            isTeachMode = !isTeachMode;
            document.body.classList.toggle('teach-mode');

            if (isTeachMode) {
                // Determine which slide is currently in view to start from there
                updateCurrentSlideFromScroll();
                enterFullscreen();
                showSlide(currentSlide);
            } else {
                exitFullscreen();
                // Scroll back to the slide we were on
                slides[currentSlide].scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        }

        function enterFullscreen() {
            const el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active-slide', i === index);
            });
        }

        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function updateCurrentSlideFromScroll() {
            // Find the slide closest to the top of the viewport
            let closestIndex = 0;
            let minDistance = Infinity;

            slides.forEach((slide, i) => {
                const rect = slide.getBoundingClientRect();
                const distance = Math.abs(rect.top);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestIndex = i;
                }
            });
            currentSlide = closestIndex;
        }

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (!isTeachMode) return;

            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'ArrowDown') {
                nextSlide();
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                prevSlide();
            } else if (e.key === 'Escape') {
                // The browser handles exiting fullscreen on Esc, 
                // but we need to catch it to sync our state if standard fullscreen exit doesn't fire events we catch well enough
                if (isTeachMode) toggleTeachMode();
            }
        });

        // Listen for fullscreen change (user pressing Esc)
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && isTeachMode) {
                toggleTeachMode();
            }
        });


        // --- 1. LCG Code ---
        function runLCG() {
            let seed = 1234;
            let out = "";
            for (let i = 0; i < 30; i++) {
                seed = (32533521 * seed + 2424) % 100;
                out += seed + ", ";
            }
            printTo('out-lcg', "First 30 numbers:<br>" + out + "...", false);
        }

        // --- 2. Park-Miller Code ---
        function runParkMiller() {
            let seed = 1234;
            const M = 2147483647;
            let out = "";
            for (let i = 0; i < 30; i++) {
                seed = (16807 * seed) % M;
                out += seed + ", ";
            }
            printTo('out-pm', "Sequence:<br>" + out + "...", false);
        }

        // --- 3. Histogram Plot (Uniform) ---
        function runPMHist() {
            let seed = 1234;
            const M = 2147483647;
            const data = [];
            for (let i = 0; i < 100000; i++) {
                seed = (16807 * seed) % M;
                data.push(seed / M);
            }
            const trace = { x: data, type: 'histogram', marker: { color: '#eab308' } };
            Plotly.newPlot('plot-pm', [trace], { margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'Uniform Distribution', height: 250 });
        }

        // --- 4. XORSHIFT ---
        function runXorShift() {
            let seed = 1234n;
            let out = "";
            for (let i = 0; i < 30; i++) {
                seed ^= (seed >> 21n);
                seed ^= (seed << 35n);
                seed ^= (seed >> 4n);
                let val = Number(seed & 0xffffffffn);
                out += val + ", ";
            }
            printTo('out-xor', "Sequence:<br>" + out + "...", false);
        }

        // --- 5. MWC ---
        function runMWC() {
            let seed = 1234n;
            let out = "";
            const a = 4294957665n;
            for (let i = 0; i < 30; i++) {
                seed = (seed & 0xffffffffn) * a + (seed >> 32n);
                let val = Number(seed & 0xffffffffn);
                out += val + ", ";
            }
            printTo('out-mwc', "Sequence:<br>" + out + "...", false);
        }

        // --- 6. Combined ---
        function runCombined() {
            let s1 = 1234n, s2 = 5678n;
            const a = 4294957665n;
            let out = "";
            for (let i = 0; i < 30; i++) {
                s1 ^= (s1 >> 17n); s1 ^= (s1 << 31n); s1 ^= (s1 >> 8n);
                s2 = (s2 & 0xffffffffn) * a + (s2 >> 32n);
                let val = Number((s1 ^ s2) & 0xffffffffn);
                out += val + ", ";
            }
            printTo('out-comb', "Sequence:<br>" + out + "...", false);
        }

        // --- 7. Wrong Plot ---
        function runWrong() {
            const data = Array.from({ length: 10000 }, () => Math.random());
            const trace = { x: data, type: 'histogram', marker: { color: '#eab308' } };
            Plotly.newPlot('plot-wrong', [trace], { margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'Result (Flat)', height: 250 });
        }

        // --- 8. Hit or Miss ---
        function runHitMiss() {
            const f = (x) => x - x * x + x * x * x - Math.pow(x, 4) + Math.sin(x * 13) / 13;
            const data = [];
            for (let i = 0; i < 20000; i++) {
                let x = Math.random();
                let y = Math.random() * 0.45;
                if (y < f(x)) data.push(x);
            }
            const trace = { x: data, type: 'histogram', marker: { color: '#eab308' } };
            Plotly.newPlot('plot-hitmiss', [trace], { margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'Rejection Sampling', height: 250 });
        }

        // --- 9. Inverse Transform ---
        function runInverse() {
            const data = [];
            const e = Math.exp(1);
            for (let i = 0; i < 10000; i++) {
                let r = Math.random();
                // -ln(1 - r + r/e) approximation from example code
                data.push(-Math.log(1 - r + r / e));
            }
            const trace = { x: data, type: 'histogram', marker: { color: '#eab308' } };
            Plotly.newPlot('plot-inverse', [trace], { margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'Exponential Dist.', height: 250 });
        }

        // --- 10. Box Muller ---
        function runBoxMuller() {
            const x = [], y = [];
            for (let i = 0; i < 10000; i++) {
                const r1 = Math.random(), r2 = Math.random();
                const R = Math.sqrt(-2 * Math.log(r1));
                x.push(R * Math.cos(2 * Math.PI * r2));
                y.push(R * Math.sin(2 * Math.PI * r2));
            }
            Plotly.newPlot('plot-gauss', [
                { x: x, type: 'histogram', opacity: 0.5, name: 'X', marker: { color: 'gold' } },
                { x: y, type: 'histogram', opacity: 0.5, name: 'Y', marker: { color: 'cyan' } }
            ], { margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'Gaussian X & Y', height: 250, barmode: 'overlay' });
        }

        // --- 11. CLT ---
        function runCLT() {
            const data = new Array(10000).fill(0);
            for (let k = 0; k < 6; k++) {
                for (let i = 0; i < 10000; i++) data[i] += Math.random();
            }
            Plotly.newPlot('plot-clt', [{ x: data, type: 'histogram', marker: { color: '#eab308' } }], {
                margin: { t: 40, b: 20, l: 30, r: 10 }, title: 'CLT Summation', height: 250
            });
        }

        // --- 12. Monte Carlo ---
        function runMC() {
            const n = 1000000;
            const batch = 10000; // Simulating small batch for browser speed
            let sum = 0;
            for (let i = 0; i < batch; i++) {
                const vals = Array.from({ length: 6 }, () => Math.random());
                const [a, b, c, d, e, f] = vals;
                sum += Math.sin(a) + Math.sin(2 * b) + Math.sin(3 * c) +
                    Math.cos(d) + Math.cos(2 * e) + Math.cos(3 * f);
            }
            const exact = 3.17426;
            const avg = sum / batch;

            printTo('out-mc', `Exact: ${exact}`, false);
            printTo('out-mc', `Random: ${avg.toFixed(5)} (Simulated)`, true);
            printTo('out-mc', `Diff: ${(avg - exact).toFixed(5)}`, true);
            printTo('out-mc', `Grid (Box) Method: 3.17555 (Pre-calc)`, true);
        }

        document.addEventListener("DOMContentLoaded", function () {
            hljs.highlightAll();
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>
</body>

</html>