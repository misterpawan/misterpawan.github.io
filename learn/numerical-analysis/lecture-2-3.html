<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 2-3: Differentiation & Integration üìê</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ntu: {
                            red: '#e11d48',
                            blue: '#1e3a8a',
                            light: '#eff6ff',
                            accent: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'sans-serif'],
                        mono: ['Consolas', 'Monaco', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .slide-card {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        /* Editor & Output Styles */
        .editor-container {
            position: relative;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            margin-bottom: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .editor-wrapper {
            position: relative;
            min-height: 250px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            background-color: #ffffff;
        }

        .editor-wrapper textarea,
        .editor-wrapper pre {
            margin: 0;
            padding: 1rem;
            border: none;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            white-space: pre;
            overflow: auto;
            position: absolute;
            top: 0;
            left: 0;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            tab-size: 4;
        }

        .editor-wrapper textarea {
            z-index: 2;
            color: transparent;
            background: transparent;
            caret-color: #000;
            resize: none;
            outline: none;
        }

        .editor-wrapper pre {
            z-index: 1;
            background: transparent;
            pointer-events: none;
        }

        .run-bar {
            background: #f1f5f9;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .run-btn {
            background: #1e3a8a;
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .run-btn:hover {
            background: #1e40af;
        }

        .run-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .output-box {
            margin-top: 0.5rem;
            background: #ffffff;
            color: #334155;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            min-height: 100px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .output-img {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }

        .math-box {
            background: #eff6ff;
            border-left: 4px solid #1e3a8a;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
            overflow-x: auto;
        }

        /* Teach Mode Styles */
        body.teach-mode {
            overflow: hidden;
            background: black;
        }

        body.teach-mode nav,
        body.teach-mode header,
        body.teach-mode footer {
            display: none !important;
        }

        body.teach-mode main {
            max-width: none;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.teach-mode .slide-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
            padding: 4rem;
            z-index: 100;
            overflow-y: auto;
            align-content: center;
        }

        body.teach-mode .slide-card.active-slide {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .teach-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #e11d48;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .teach-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(225, 29, 72, 0.5);
        }

        body.teach-mode .teach-btn {
            display: none;
        }
    </style>
</head>

<body class="antialiased">

    <button onclick="toggleTeachMode()" class="teach-btn">
        <span>üë®‚Äçüè´</span> Teach Mode
    </button>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-xl text-slate-800">Numerical Analysis <span
                    class="text-ntu-blue">2-3</span></span>
            <div class="hidden md:flex space-x-1 text-sm font-medium text-slate-600">
                <a href="#intro" class="px-3 py-1 hover:bg-gray-100 rounded">Intro</a>
                <a href="#derivatives" class="px-3 py-1 hover:bg-gray-100 rounded">Diff</a>
                <a href="#central" class="px-3 py-1 hover:bg-gray-100 rounded">Central</a>
                <a href="#richardson" class="px-3 py-1 hover:bg-gray-100 rounded">Richardson</a>
                <a href="#integration" class="px-3 py-1 hover:bg-gray-100 rounded">Integration</a>
                <a href="#gaussian" class="px-3 py-1 hover:bg-gray-100 rounded">Gaussian</a>
            </div>
        </div>
    </nav>

    <header class="pt-24 pb-16 text-center px-4 bg-gradient-to-b from-blue-50 to-transparent">
        <h1 class="text-5xl md:text-6xl font-extrabold text-slate-900 mb-6 tracking-tight">
            Differentiation & Integration üìê
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-8">
            Calculus without the symbols. Just sums and differences.
        </p>
        <div class="flex justify-center gap-4 text-sm text-gray-500 font-mono">
            <span>Lecture 2-3</span>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20">

        <section id="intro" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">1. Why Numerical Calculus? ü§î</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 1-4</span>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-2">The Motivation</h3>
                    <ul class="list-disc ml-5 space-y-2 text-slate-600">
                        <li><strong>Black Box Functions:</strong> You can't analytically differentiate a simulation or
                            experiment.</li>
                        <li><strong>Complexity:</strong> Formulas like $\frac{d}{dx}(x \sin(x^2)\ln(x))$ are error-prone
                            by hand.</li>
                        <li><strong>Discrete Data:</strong> Real world data comes in points, not equations.</li>
                    </ul>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 text-center flex flex-col justify-center">
                    <div class="text-4xl mb-4">ü§ñ</div>
                    <p class="font-serif italic text-slate-700">"Computers are bad at limits ($h \to 0$), but excellent
                        at loops."</p>
                </div>
            </div>
        </section>

        <section id="derivatives" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">2. Numerical Differentiation</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 5-9</span>
            </div>

            <h3 class="font-bold text-xl mb-4">Forward Difference</h3>
            <div class="math-box text-sm mb-4">
                $$ f'(x) \approx \frac{f(x+h) - f(x)}{h} $$
            </div>
            <p class="text-sm text-slate-600 mb-4">
                Looks simple, but suffers from the <strong>Step Size Dilemma</strong>. Too big = bad approximation. Too
                small = round-off noise.
            </p>
            <div id="code-01"></div>
        </section>

        <section id="central" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">3. Central Difference üéØ</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 10-13</span>
            </div>

            <p class="text-slate-600 mb-4">Look both ways! Cancellations lead to better accuracy.</p>
            <div class="math-box text-sm mb-4">
                $$ f'(x) \approx \frac{f(x+h) - f(x-h)}{2h} $$
                Error drops from $O(h)$ to $O(h^2)$.
            </div>
            <div id="code-02"></div>
        </section>

        <section id="richardson" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">4. Richardson Extrapolation üöÄ</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 14-17</span>
            </div>
            <p class="text-slate-600 mb-4">Combine two bad estimates to make one good one.</p>
            <div id="code-03"></div>
        </section>

        <section id="integration" class="slide-card border-l-4 border-ntu-blue">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">5. Numerical Integration üß±</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 31-40</span>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Trapezoidal Rule</h3>
                <p class="text-sm text-slate-600 mb-2">Connect the dots with lines. Calculate area of trapezoids.</p>
                <div id="code-trap"></div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Simpson's Rule üç©</h3>
                <p class="text-sm text-slate-600 mb-2">Connect dots with parabolas. Weights: 1, 4, 1.</p>
                <div id="code-simp"></div>
            </div>
        </section>

        <section id="gaussian" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">6. Advanced: Gaussian & SciPy üß†</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 43-49</span>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">Gaussian Quadrature</h3>
                    <p class="text-sm text-slate-600 mb-4">
                        Pick smart points $x_i$ and weights $w_i$. Integration becomes exact for polynomials.
                    </p>
                    <div id="code-gauss"></div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">SciPy `quad`</h3>
                    <p class="text-sm text-slate-600 mb-4">
                        The industrial standard. Adaptive, fast, robust.
                    </p>
                    <div id="code-scipy-quad"></div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t py-12 text-center text-sm text-gray-400 mt-12">
        <p>Numerical Analysis Lecture 2-3</p>
    </footer>

    <script>
        // --- Teach Mode Logic ---
        let isTeachMode = false;
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide-card');

        function toggleTeachMode() {
            isTeachMode = !isTeachMode;
            document.body.classList.toggle('teach-mode');

            if (isTeachMode) {
                updateCurrentSlideFromScroll();
                enterFullscreen();
                showSlide(currentSlide);
            } else {
                exitFullscreen();
                slides[currentSlide].scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        }

        function enterFullscreen() {
            const el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active-slide', i === index);
            });
        }

        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function updateCurrentSlideFromScroll() {
            let closestIndex = 0;
            let minDistance = Infinity;
            slides.forEach((slide, i) => {
                const rect = slide.getBoundingClientRect();
                const distance = Math.abs(rect.top);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestIndex = i;
                }
            });
            currentSlide = closestIndex;
        }

        document.addEventListener('keydown', (e) => {
            if (!isTeachMode) return;
            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'ArrowDown') nextSlide();
            else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();
            else if (e.key === 'Escape') {
                if (isTeachMode) toggleTeachMode();
            }
        });

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && isTeachMode) toggleTeachMode();
        });


        // --- Pyodide Setup ---
        let pyodide = null;
        async function initPyodideEnvironment() {
            if (pyodide) return pyodide;
            pyodide = await loadPyodide();
            await pyodide.loadPackage(['numpy', 'matplotlib', 'scipy']);
            return pyodide;
        }

        async function runPythonCode(code) {
            await initPyodideEnvironment();
            const setupCode = `
import sys
import io
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
plt.close('all')
sys.stdout = io.StringIO()
sys.stderr = io.StringIO()
`;
            const cleanupCode = `
stdout_val = sys.stdout.getvalue()
stderr_val = sys.stdout.getvalue()
`;
            const plotSaver = `
import base64
buf = io.BytesIO()
if plt.get_fignums() and len(plt.gcf().axes) > 0:
    plt.savefig(buf, format='png', bbox_inches='tight')
    buf.seek(0)
    img_str = base64.b64encode(buf.read()).decode('UTF-8')
else:
    img_str = ""
img_str
`;
            try {
                await pyodide.runPythonAsync(setupCode + code + cleanupCode);
                const stdout = pyodide.runPython("stdout_val");
                const stderr = pyodide.runPython("stderr_val");
                const imgB64 = pyodide.runPython(plotSaver);
                return { stdout, stderr, image: imgB64 ? 'data:image/png;base64,' + imgB64 : null };
            } catch (err) {
                return { error: err.message };
            }
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CodeRunner = ({ id, filename, initialCode }) => {
            const [code, setCode] = useState(initialCode);
            const [output, setOutput] = useState("");
            const [imageSrc, setImageSrc] = useState(null);
            const [status, setStatus] = useState("idle");
            const textareaRef = useRef(null);
            const preRef = useRef(null);

            useEffect(() => {
                if (preRef.current) {
                    preRef.current.removeAttribute('data-highlighted');
                    hljs.highlightElement(preRef.current);
                }
            }, [code]);

            const handleRun = async () => {
                setStatus("running");
                setOutput("");
                setImageSrc(null);
                const result = await runPythonCode(code);
                if (result.error) {
                    setStatus("error");
                    setOutput(result.error);
                } else {
                    setStatus("success");
                    setOutput(result.stdout || (result.image ? "" : "Done (no output)"));
                    if (result.image) setImageSrc(result.image);
                }
            };

            const handleScroll = () => {
                if (textareaRef.current && preRef.current) {
                    preRef.current.scrollTop = textareaRef.current.scrollTop;
                    preRef.current.scrollLeft = textareaRef.current.scrollLeft;
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = e.target.selectionStart;
                    const end = e.target.selectionEnd;
                    setCode(code.substring(0, start) + "    " + code.substring(end));
                    setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = start + 4; }, 0);
                }
            };

            return (
                <div className="mb-6">
                    <div className="editor-container">
                        <div className="run-bar">
                            <span className="text-xs font-mono text-gray-500 font-bold">{filename}</span>
                            <button onClick={handleRun} disabled={status === 'running'} className="run-btn">
                                {status === 'running' ? 'Running...' : '‚ñ∂ Run Code'}
                            </button>
                        </div>
                        <div className="editor-wrapper">
                            <textarea
                                ref={textareaRef}
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                onScroll={handleScroll}
                                onKeyDown={handleKeyDown}
                                spellCheck="false"
                            />
                            <pre ref={preRef}><code className="language-python">{code}</code></pre>
                        </div>
                    </div>
                    <div className="output-box">
                        {status === 'idle' && <div className="text-gray-400 italic">Click run to start...</div>}
                        {status === 'running' && <div className="text-blue-500 animate-pulse">Running simulation...</div>}
                        {status === 'error' && <div className="text-red-500 font-bold">Error Traceback:</div>}
                        <div>{output}</div>
                        {imageSrc && <img src={imageSrc} className="output-img" />}
                    </div>
                </div>
            );
        };

        const code01 = `import math

def f(x):  
    return x**2+math.exp(x)+math.log(x)+math.sin(x)
def fp(x): 
    return 2.*x+math.exp(x)+1./x+math.cos(x)

x, h = 0.5, 1E-2
fp_exact = fp(x)

while h>1E-15:
    fp_numeric = (f(x+h) - f(x))/h	
    print('h = %e' % h)
    print('Exact = %.16f,' % fp_exact, end=' ')
    print('Numeric = %.16f,' % fp_numeric, end=' ')
    print('diff = %.16f' % abs(fp_numeric-fp_exact))
    h /= 10.`;

        const code02 = `import math
import scipy.misc as misc

def f(x):  
    return x**2+math.exp(x)+math.log(x)+math.sin(x)
def fp(x): 
    return 2.*x+math.exp(x)+1./x+math.cos(x)

x, h = 0.5, 1E-2
fp_exact = fp(x)

while h>1E-15:
    # Central difference formula
    fp_numeric = misc.derivative(f, x, dx=h, n=1, order=3) 
    print('h = %e' % h)
    print('diff = %.16e' % abs(fp_numeric-fp_exact))
    h /= 10.`;

        const code03 = `import math

def f(x): return x**2 + math.exp(x) + math.log(x) + math.sin(x)
def fp(x): return 2.*x + math.exp(x) + 1./x + math.cos(x)

x = 0.5
h = 1E-3
exact = fp(x)

# Richardson Formula
fp_richardson = (8.*f(x+h/4.) + f(x-h/2.) - 8.*f(x-h/4.) - f(x+h/2.)) / (h*3.)

print(f"h = {h}")
print(f"Exact: {exact}")
print(f"Rich.: {fp_richardson}")
print(f"Error: {abs(fp_richardson - exact):.2e}")`;

        const codeTrap = `import numpy as np
import matplotlib.pyplot as plt

def f(x):
    return x - x**2 + x**3 - x**4 + np.sin(x*13.)/13.

def fint(x):
    return x**2/2. - x**3/3. + x**4/4. - x**5/5. - np.cos(x*13.)/169.

a, b = 0.0, 1.2
n = 10 # Number of trapezoids
h = (b-a)/n

# Exact Integral
exact = fint(b) - fint(a)

# Trapezoidal Calculation
x = np.linspace(a, b, n+1)
y = f(x)
area = (h/2) * (y[0] + 2*np.sum(y[1:-1]) + y[-1])

print(f"Exact: {exact:.6f}")
print(f"Trapezoidal: {area:.6f}")
print(f"Error: {abs(exact-area):.6e}")

# Plotting
x_plot = np.linspace(a-0.1, b+0.1, 200)
y_plot = f(x_plot)

plt.figure(figsize=(8, 5))
plt.plot(x_plot, y_plot, 'b-', label='f(x)')

# Plot Trapezoids
for i in range(n):
    xs = [x[i], x[i], x[i+1], x[i+1]]
    ys = [0, f(x[i]), f(x[i+1]), 0]
    plt.fill(xs, ys, 'r', edgecolor='r', alpha=0.2)
    # Draw top line explicitly
    plt.plot([x[i], x[i+1]], [y[i], y[i+1]], 'r-', lw=1)

plt.plot(x, y, 'ro', label='Sample Points')
plt.title(f'Trapezoidal Rule (n={n})')
plt.legend()
plt.grid(True, alpha=0.3)
plt.axhline(0, color='black', linewidth=1)
plt.show()`;

        const codeSimp = `import numpy as np
import matplotlib.pyplot as plt

def f(x):
    return x - x**2 + x**3 - x**4 + np.sin(x*13.)/13.

def fint(x):
    return x**2/2. - x**3/3. + x**4/4. - x**5/5. - np.cos(x*13.)/169.

a, b = 0.0, 1.2
n = 6 # Number of intervals (must be even)
h = (b-a)/n

# Exact Integral
exact = fint(b) - fint(a)

# Simpson's Calculation
x = np.linspace(a, b, n+1)
y = f(x)
area = (h/3) * (y[0] + 4*np.sum(y[1:n:2]) + 2*np.sum(y[2:n-1:2]) + y[n])

print(f"Exact: {exact:.6f}")
print(f"Simpson's: {area:.6f}")
print(f"Error: {abs(exact-area):.6e}")

# Plotting
x_plot = np.linspace(a-0.1, b+0.1, 200)
y_plot = f(x_plot)

plt.figure(figsize=(8, 5))
plt.plot(x_plot, y_plot, 'b-', label='f(x)')

# Plot Parabolas
for i in range(0, n, 2):
    # Interpolate quadratic over the pair of intervals
    x_interval = np.linspace(x[i], x[i+2], 50)
    xw = x[i:i+3]
    yw = y[i:i+3]
    
    # Lagrange Basis Polynomials
    L0 = (x_interval - xw[1])*(x_interval - xw[2]) / ((xw[0]-xw[1])*(xw[0]-xw[2]))
    L1 = (x_interval - xw[0])*(x_interval - xw[2]) / ((xw[1]-xw[0])*(xw[1]-xw[2]))
    L2 = (x_interval - xw[0])*(x_interval - xw[1]) / ((xw[2]-xw[0])*(xw[2]-xw[1]))
    y_interval = yw[0]*L0 + yw[1]*L1 + yw[2]*L2
    
    plt.fill_between(x_interval, y_interval, color='g', alpha=0.2)
    plt.plot(x_interval, y_interval, 'g--', alpha=0.5)

plt.plot(x, y, 'go', label='Sample Points')
plt.title(f"Simpson's Rule (n={n})")
plt.legend()
plt.grid(True, alpha=0.3)
plt.axhline(0, color='black', linewidth=1)
plt.show()`;

        const codeGauss = `import math

def f(x):
    return x - x**2 + x**3 - x**4 + math.sin(x*13.)/13.
def fint(x):
    return x**2/2. - x**3/3. + x**4/4. - x**5/5. - math.cos(x*13.)/169.

fint_exact = fint(1.2)-fint(0.)
npoints = 21
# Gauss-Legendre Weights (Abbreviated for display)
weights = [[0.14608, +0.0],[0.14452, -0.145],[0.14452, +0.145],
           [0.13988, -0.288],[0.13988, +0.288],[0.13226, -0.424],
           [0.13226, +0.424],[0.12183, -0.551],[0.12183, +0.551]] 
           # In real usage, use numpy.polynomial.legendre.leggauss

area, min, max = 0., 0., 1.2

# Just a placeholder calculation to show logic
# Real Gauss typically uses pre-calculated high precision weights
print("Gaussian Quadrature requires precise weights.")
print("See l202-example-05.py for full table.")`;

        const codeSciPyQuad = `import math
import scipy.integrate as integrate

def f(x):
    return x - x**2 + x**3 - x**4 + math.sin(x*13.)/13.
def fint(x):
    return x**2/2. - x**3/3. + x**4/4. - x**5/5. - math.cos(x*13.)/169.

fint_exact = fint(1.2)-fint(0.)

quad,quaderr = integrate.quad(f,0.,1.2)

print('Exact: %.16f' %  fint_exact)
print('SciPy Quad: %.16f (Error est: %.1e)' % (quad,quaderr))`;


        const root = ReactDOM.createRoot(document.getElementById('code-01'));
        root.render(<CodeRunner filename="l202-example-01.py" initialCode={code01} />);

        ReactDOM.createRoot(document.getElementById('code-02')).render(<CodeRunner filename="l202-example-02.py" initialCode={code02} />);
        ReactDOM.createRoot(document.getElementById('code-03')).render(<CodeRunner filename="l202-example-03.py" initialCode={code03} />);

        ReactDOM.createRoot(document.getElementById('code-trap')).render(<CodeRunner filename="l202-example-03 (1).py" initialCode={codeTrap} />);
        ReactDOM.createRoot(document.getElementById('code-simp')).render(<CodeRunner filename="l202-example-04.py" initialCode={codeSimp} />);

        ReactDOM.createRoot(document.getElementById('code-gauss')).render(<CodeRunner filename="l202-example-05.py" initialCode={codeGauss} />);
        ReactDOM.createRoot(document.getElementById('code-scipy-quad')).render(<CodeRunner filename="l202-example-06.py" initialCode={codeSciPyQuad} />);

        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false }
            ]
        });
    </script>
</body>

</html>