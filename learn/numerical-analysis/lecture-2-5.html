<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 2-5: Root Finding & Minimization üìâ</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ntu: {
                            red: '#e11d48',
                            blue: '#1e3a8a',
                            light: '#eff6ff',
                            accent: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'sans-serif'],
                        mono: ['Consolas', 'Monaco', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .slide-card {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        /* Editor & Output Styles */
        .editor-container {
            position: relative;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            margin-bottom: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .editor-wrapper {
            position: relative;
            min-height: 250px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            background-color: #ffffff;
        }

        .editor-wrapper textarea,
        .editor-wrapper pre {
            margin: 0;
            padding: 1rem;
            border: none;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            white-space: pre;
            overflow: auto;
            position: absolute;
            top: 0;
            left: 0;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            tab-size: 4;
        }

        .editor-wrapper textarea {
            z-index: 2;
            color: transparent;
            background: transparent;
            caret-color: #000;
            resize: none;
            outline: none;
        }

        .editor-wrapper pre {
            z-index: 1;
            background: transparent;
            pointer-events: none;
        }

        .run-bar {
            background: #f1f5f9;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .run-btn {
            background: #1e3a8a;
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .run-btn:hover {
            background: #1e40af;
        }

        .run-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .output-box {
            margin-top: 0.5rem;
            background: #ffffff;
            color: #334155;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            min-height: 100px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .output-img {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }

        .math-box {
            background: #eff6ff;
            border-left: 4px solid #1e3a8a;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
            overflow-x: auto;
        }

        /* Teach Mode Styles */
        html.teach-mode-active {
            font-size: 200%;
        }

        body.teach-mode {
            overflow: hidden;
            background: black;
        }

        body.teach-mode nav,
        body.teach-mode header,
        body.teach-mode footer {
            display: none !important;
        }

        body.teach-mode main {
            max-width: none;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.teach-mode .slide-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
            padding: 4rem;
            z-index: 100;
            overflow-y: auto;
            align-content: center;
        }

        body.teach-mode .slide-card.active-slide {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .teach-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #e11d48;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .teach-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(225, 29, 72, 0.5);
        }

        body.teach-mode .teach-btn {
            display: none;
        }
    </style>
</head>

<body class="antialiased">

    <button onclick="toggleTeachMode()" class="teach-btn">
        <span>üë®‚Äçüè´</span> Teach Mode
    </button>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-xl text-slate-800">Numerical Analysis <span
                    class="text-ntu-blue">2-5</span></span>
            <div class="hidden md:flex space-x-1 text-sm font-medium text-slate-600">
                <a href="#intro" class="px-3 py-1 hover:bg-gray-100 rounded">Intro</a>
                <a href="#roots" class="px-3 py-1 hover:bg-gray-100 rounded">Root Finding</a>
                <a href="#min" class="px-3 py-1 hover:bg-gray-100 rounded">Minimization</a>
                <a href="#fit" class="px-3 py-1 hover:bg-gray-100 rounded">Fitting</a>
                <a href="#genetic" class="px-3 py-1 hover:bg-gray-100 rounded">Genetic Algo</a>
            </div>
        </div>
    </nav>

    <header class="pt-24 pb-16 text-center px-4 bg-gradient-to-b from-blue-50 to-transparent">
        <h1 class="text-5xl md:text-6xl font-extrabold text-slate-900 mb-6 tracking-tight">
            Root Finding & Minimization üìâ
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-8">
            "If $f(x) = 0$, what is $x$?" <br>
            From high school algebra to the Higgs Boson.
        </p>
        <div class="flex justify-center gap-4 text-sm text-gray-500 font-mono">
            <span>Lecture 2-5</span>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20">

        <section id="intro" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">1. The Problem üå±</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 1-3</span>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <p class="mb-4 text-lg">Finding where a function crosses zero (Root) or hits bottom (Minimum) is
                        fundamental.</p>
                    <ul class="list-disc ml-5 text-slate-600 space-y-2">
                        <li><strong>Root Finding:</strong> Solve $f(x)=0$.</li>
                        <li><strong>Minimization:</strong> Solve $f'(x)=0$ (where slope is zero).</li>
                        <li>Methods are surprisingly similar!</li>
                    </ul>
                </div>
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 flex items-center justify-center">
                    <div class="text-center">
                        <div class="text-6xl mb-2">üèîÔ∏è</div>
                        <p class="font-serif italic text-slate-700">"It's just walking downhill."</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="roots" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">2. Root Finding Methods üïµÔ∏è</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 4-15</span>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Method 1: Bisection üç∞</h3>
                <p class="text-sm text-slate-600 mb-2">Robust but slow. Divide the interval in half.</p>
                <div id="code-01"></div>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Method 2: Brent's Method üöÄ</h3>
                <p class="text-sm text-slate-600 mb-2">Combines Bisection with Parabolic Interpolation. Much faster.</p>
                <div id="code-02"></div>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Method 3: Newton-Raphson üçé</h3>
                <p class="text-sm text-slate-600 mb-2">Uses derivatives. $x_{new} = x - f(x)/f'(x)$. Quadratic
                    convergence.</p>
                <div id="code-03"></div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Method 4: SciPy `opt.newton` üõ†Ô∏è</h3>
                <p class="text-sm text-slate-600 mb-2">The professional way.</p>
                <div id="code-05"></div>
            </div>
        </section>

        <section id="min" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">3. Minimization üìâ</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 16-25</span>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Golden Section Search üèÜ</h3>
                <p class="text-sm text-slate-600 mb-2">Like Bisection, but for minimums. Uses the Golden Ratio.</p>
                <div id="code-06"></div>
            </div>

            <div class="mb-12">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Brent's Method (Min) üêÜ</h3>
                <p class="text-sm text-slate-600 mb-2">Parabolic interpolation for the minimum.</p>
                <div id="code-07"></div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold text-slate-800 mb-2">Multivariate Minimization (SciPy) üåê</h3>
                <p class="text-sm text-slate-600 mb-2">Finding minimum in 3D space ($x,y,z$).</p>
                <div id="code-09"></div>
            </div>
        </section>

        <section id="fit" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">4. Curve Fitting (The Higgs) ‚öõÔ∏è</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 26-35</span>
            </div>

            <p class="mb-4 text-slate-600">Fitting theoretical models to data is just <strong>Minimizing</strong> the
                Chi-Square error!</p>
            <div class="math-box text-sm mb-6">
                $$ \chi^2 = \sum \frac{(y_{data} - y_{model})^2}{\sigma^2} $$
            </div>

            <div id="code-10b"></div>
        </section>

        <section id="genetic" class="slide-card bg-gradient-to-br from-indigo-50 to-purple-50 border-indigo-100">
            <div class="flex justify-between items-center border-b border-indigo-200 pb-4 mb-6">
                <h2 class="text-3xl font-bold text-indigo-900">5. Genetic Algorithms üß¨</h2>
                <span class="bg-indigo-100 px-3 py-1 rounded text-xs font-mono text-indigo-800">Slides 40+</span>
            </div>

            <div class="mb-8">
                <p class="text-slate-700 mb-4">
                    What if the function is ugly, discontinuous, or has many traps? Gradient methods fail.
                    We use <strong>Evolution</strong>: Selection, Crossover, Mutation.
                </p>
                <div class="flex justify-center gap-4 text-2xl">
                    <span>ü¶ç</span> ‚û°Ô∏è <span>üßç</span>
                </div>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-bold text-indigo-800 mb-2">Brute Force Scan (Slow)</h4>
                    <div id="code-11a"></div>
                </div>
                <div>
                    <h4 class="font-bold text-purple-800 mb-2">Genetic Solution (Smart)</h4>
                    <div id="code-11b"></div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t py-12 text-center text-sm text-gray-400 mt-12">
        <p>Numerical Analysis Lecture 2-5</p>
    </footer>

    <script>
        // --- Teach Mode Logic (Preserved) ---
        let isTeachMode = false;
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide-card');

        function toggleTeachMode() {
            isTeachMode = !isTeachMode;
            document.body.classList.toggle('teach-mode');

            if (isTeachMode) {
                updateCurrentSlideFromScroll();
                enterFullscreen();
                showSlide(currentSlide);
            } else {
                exitFullscreen();
                slides[currentSlide].scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        }

        function enterFullscreen() {
            const el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active-slide', i === index);
            });
        }

        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function updateCurrentSlideFromScroll() {
            let closestIndex = 0;
            let minDistance = Infinity;
            slides.forEach((slide, i) => {
                const rect = slide.getBoundingClientRect();
                const distance = Math.abs(rect.top);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestIndex = i;
                }
            });
            currentSlide = closestIndex;
        }

        document.addEventListener('keydown', (e) => {
            if (!isTeachMode) return;
            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'ArrowDown') nextSlide();
            else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();
            else if (e.key === 'Escape') {
                if (isTeachMode) toggleTeachMode();
            }
        });

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && isTeachMode) toggleTeachMode();
        });


        // --- Pyodide Setup ---
        let pyodide = null;
        async function initPyodideEnvironment() {
            if (pyodide) return pyodide;
            pyodide = await loadPyodide();
            await pyodide.loadPackage(['numpy', 'matplotlib', 'scipy']);
            return pyodide;
        }

        async function runPythonCode(code) {
            await initPyodideEnvironment();
            const setupCode = `
import sys
import io
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
plt.close('all')
sys.stdout = io.StringIO()
sys.stderr = io.StringIO()
`;
            const cleanupCode = `
stdout_val = sys.stdout.getvalue()
stderr_val = sys.stdout.getvalue()
`;
            const plotSaver = `
import base64
buf = io.BytesIO()
if plt.get_fignums() and len(plt.gcf().axes) > 0:
    plt.savefig(buf, format='png', bbox_inches='tight')
    buf.seek(0)
    img_str = base64.b64encode(buf.read()).decode('UTF-8')
else:
    img_str = ""
img_str
`;
            try {
                await pyodide.runPythonAsync(setupCode + code + cleanupCode);
                const stdout = pyodide.runPython("stdout_val");
                const stderr = pyodide.runPython("stderr_val");
                const imgB64 = pyodide.runPython(plotSaver);
                return { stdout, stderr, image: imgB64 ? 'data:image/png;base64,' + imgB64 : null };
            } catch (err) {
                return { error: err.text || err.message };
            }
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CodeRunner = ({ id, filename, initialCode }) => {
            const [code, setCode] = useState(initialCode);
            const [output, setOutput] = useState("");
            const [imageSrc, setImageSrc] = useState(null);
            const [status, setStatus] = useState("idle");
            const textareaRef = useRef(null);
            const preRef = useRef(null);

            useEffect(() => {
                if (preRef.current) {
                    preRef.current.removeAttribute('data-highlighted');
                    hljs.highlightElement(preRef.current);
                }
            }, [code]);

            const handleRun = async () => {
                setStatus("running");
                setOutput("");
                setImageSrc(null);
                const result = await runPythonCode(code);
                if (result.error) {
                    setStatus("error");
                    setOutput(result.error);
                } else {
                    setStatus("success");
                    setOutput(result.stdout || (result.image ? "" : "Done (no output)"));
                    if (result.image) setImageSrc(result.image);
                }
            };

            const handleScroll = () => {
                if (textareaRef.current && preRef.current) {
                    preRef.current.scrollTop = textareaRef.current.scrollTop;
                    preRef.current.scrollLeft = textareaRef.current.scrollLeft;
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = e.target.selectionStart;
                    const end = e.target.selectionEnd;
                    setCode(code.substring(0, start) + "    " + code.substring(end));
                    setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = start + 4; }, 0);
                }
            };

            return (
                <div className="mb-6">
                    <div className="editor-container">
                        <div className="run-bar">
                            <span className="text-xs font-mono text-gray-500 font-bold">{filename}</span>
                            <button onClick={handleRun} disabled={status === 'running'} className="run-btn">
                                {status === 'running' ? 'Running...' : '‚ñ∂ Run Code'}
                            </button>
                        </div>
                        <div className="editor-wrapper">
                            <textarea
                                ref={textareaRef}
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                onScroll={handleScroll}
                                onKeyDown={handleKeyDown}
                                spellCheck="false"
                            />
                            <pre ref={preRef}><code className="language-python">{code}</code></pre>
                        </div>
                    </div>
                    <div className="output-box">
                        {status === 'idle' && <div className="text-gray-400 italic">Click run to start...</div>}
                        {status === 'running' && <div className="text-blue-500 animate-pulse">Running simulation...</div>}
                        {status === 'error' && <div className="text-red-500 font-bold">Error Traceback:</div>}
                        <div>{output}</div>
                        {imageSrc && <img src={imageSrc} className="output-img" />}
                    </div>
                </div>
            );
        };

        const code01 = `def f(x):
    return (x-1.)*(x-2.)*(x-3.)*(x-4.)*(x-5.)

a, b = 2.4, 3.4
fa, fb = f(a), f(b)

for step in range(50):
    c = (a+b)*0.5
    fc = f(c)	

    print('Step: %2d, root = %.16f, diff = %.16f' % (step,c,abs(c-3.)))
    
    if abs(a-c)<1E-14: break
    
    if fc*fa>0.:
        a, fa = c, fc
    else:
        b, fb = c, fc`;

        const code02 = `def f(x):
    return (x-1.)*(x-2.)*(x-3.)*(x-4.)*(x-5.)

a, b, c = 2.4, 2.5, 3.4
fa, fb, fc = f(a), f(b), f(c)

for step in range(50):
    
    R, S, T  = fb/fc, fb/fa, fa/fc
    P  = S*(T*(R-T)*(c-b)-(1.-R)*(b-a))
    Q  = (T-1.)*(R-1.)*(S-1.)
		
    d  = b + P/Q
    fd = f(d)
    
    # Simple check to avoid division by zero or wild jumps not shown for brevity
    
    print('Step: %2d, root = %.16f, diff = %.16f' % (step,d,abs(d-3.)))
    
    if abs(b-d)<1E-14: break
    
    if fa*fb>0.:
        a, fa = b, fb
        b, fb = d, fd
    else:
        c, fc = b, fb
        b, fb = d, fd`;

        const code03 = `def f(x):
    return (x-1.)*(x-2.)*(x-3.)*(x-4.)*(x-5.)

def fp(x):
    # Derivative
    return (x-2.)*(x-3.)*(x-4.)*(x-5.) + \\
           (x-1.)*(x-3.)*(x-4.)*(x-5.) + \\
           (x-1.)*(x-2.)*(x-4.)*(x-5.) + \\
           (x-1.)*(x-2.)*(x-3.)*(x-5.) + \\
           (x-1.)*(x-2.)*(x-3.)*(x-4.)

b = 2.5
fb = f(b)

for step in range(50):

    delta = -fb/fp(b)		
    d  = b + delta
    fd = f(d)

    print('Step: %2d, root = %.16f, diff = %.16f' % (step,d,abs(d-3.)))

    if abs(b-d)<1E-14: break

    b, fb = d, fd`;

        const code05 = `import scipy.optimize as opt
 
def squareroot(R):
    fsq = lambda x:x*x-R
    fsqp = lambda x:2.*x
    
    return opt.newton(fsq,R*0.5,fsqp)

R = 1234.
   
print('root = %.16f, diff = %.16f' % \\
    (squareroot(R),abs(R**0.5-squareroot(R))))`;

        const code06 = `def f(x):
    return (x-0.5)*(x-0.5)*(x-10.)*(x-10.)

FRAC = 0.38197
a, c = 0.0, 2.0
fa, fc = f(a), f(c)
b = a+(c-a)*FRAC
fb = f(b)

for step in range(150):

    if abs(a-b)>abs(c-b): d = b+(a-b)*FRAC
    else:                 d = b+(c-b)*FRAC
    fd = f(d)
		
    print('Step: %2d, root = %.16f, diff = %.16f' % (step,d,abs(d-0.5)))
    if abs(b-d)<1E-14: break
		
    if fd<fb:
        b, d = d, b
        fb, fd = fd, fb
	
    if (d-b)*(a-b)>0: a, fa = d, fd
    else:             c, fc = d, fd`;

        const code07 = `def f(x):
    return (x-0.5)*(x-0.5)*(x-10.)*(x-10.)

FRAC = 0.38197
a, c = 0.0, 2.0
fa, fc = f(a), f(c)
b = a+(c-a)*FRAC
fb = f(b)

for step in range(150):
    # Brent's Parabolic Interpolation Logic
    P = (b-a)*(b-a)*(fb-fc) - (b-c)*(b-c)*(fb-fa)
    Q = (b-a)*(fb-fc) - (b-c)*(fb-fa)
    d = b - 0.5*P/Q # Estimated minimum

    # Safety checks often added here in real implementations...
    
    # Just golden section fallback if parabolic fails logic omitted for brevity
    if (d-a)*(d-c)>0.:
         if abs(a-b)>abs(c-b): d = b+(a-b)*FRAC
         else:                 d = b+(c-b)*FRAC
        
    fd = f(d)		
    print('Step: %2d, root = %.16f, diff = %.16f' % (step,d,abs(d-0.5)))
    if abs(b-d)<1E-14: break
		
    if fd<fb:
        b, d = d, b
        fb, fd = fd, fb
	
    if (d-b)*(a-b)>0: a, fa = d, fd
    else:             c, fc = d, fd`;

        const code09 = `import numpy as np
import scipy.optimize as opt

def f(x):
    # Minimum at (1, 2, 3)
    return (x[0]-1.)**2+(x[1]-2.)**2+(x[2]-3.)**2

x_init = np.array([0.5,0.5,0.5])

res = opt.minimize(f,x_init)

if res.success:
    print('The resulting vector:',res.x)`;

        const code10b = `import numpy as np
import scipy.optimize as opt
import matplotlib.pyplot as plt

xmin, xmax, xbinwidth = 100., 170., 2.
vx = np.linspace(xmin+xbinwidth/2,xmax-xbinwidth/2,35)
vy = np.array(
[7,2,4,4,3,9,8,1,6,6,8,16,36,20,8,6,8,6,4,7,
 4,10,5,6,1,4,3,4,4,6,2,6,9,5,8],dtype='float64')
vyerr = vy**0.5

plt.figure(figsize=(6,4), dpi=100)
plt.errorbar(vx, vy, vyerr, c='blue', fmt = 'o')

def model(x, norm, mean, sigma, c0, c1, c2):
    xp = (x-xmin)/(xmax-xmin)
    polynomial = c0 + c1*xp + c2*xp**2
    gaussian = norm*xbinwidth/(2.*np.pi)**0.5/sigma * \\
        np.exp(-0.5*((x-mean)/sigma)**2)
    return polynomial + gaussian

p_init = np.array([70.,125.,2.,4.,0.,0.])
# Curve fit (minimizes chi2 internally)
rx,rcov = opt.curve_fit(model,vx,vy,p_init,vyerr)

print('N(Higgs) = %.1f +- %.1f events' % (rx[0],rcov[0,0]**0.5))
print('M(Higgs) = %.1f +- %.1f GeV' % (rx[1],rcov[1,1]**0.5))

cx = np.linspace(xmin,xmax,500)
cy = model(cx,rx[0],rx[1],rx[2],rx[3],rx[4],rx[5]) 
cy_bkg = model(cx,0.,rx[1],rx[2],rx[3],rx[4],rx[5])    

plt.plot(cx, cy, c='red',lw=2)
plt.plot(cx, cy_bkg, c='red',lw=2,ls='--')
plt.grid()
plt.show()`;

        const code11a = `import numpy as np
import matplotlib.pyplot as plt

np.random.seed(123456)
sig = np.random.randn(1000,2)*0.5
bkg = np.vstack([np.random.randn(1000,2)*[0.4,0.6]+[+1.,+1.],
                 np.random.randn(1000,2)*[0.7,0.3]+[-1.,-1.]])
                 
def fcn(x):
    # Simple count of signal vs background in box defined by x=[x1,x2,y1,y2]
    nsig = ((sig[:,0]>x[0]) & (sig[:,0]<x[1]) & (sig[:,1]>x[2]) & (sig[:,1]<x[3])).sum()
    nbkg = ((bkg[:,0]>x[0]) & (bkg[:,0]<x[1]) & (bkg[:,1]>x[2]) & (bkg[:,1]<x[3])).sum()
    if nsig+nbkg<1: return 0.
    return nsig/(nsig+nbkg)**0.5

print("Brute force scanning... (slow!)")
# Scanning a 4D grid...
vec = [(a,b,c,d) for a in np.arange(-1.,1.,0.5) for b in np.arange(a,1.,0.5) for c in np.arange(-1.,1.,0.5) for d in np.arange(c,1.,0.5)]
res = np.array([fcn(x) for x in vec])
best = res.argmax()
print('Best box box =',vec[best],' fcn =',res[best])`;

        const code11b = `import numpy as np
import matplotlib.pyplot as plt

np.random.seed(123456)
sig = np.random.randn(1000,2)*0.5
bkg = np.vstack([np.random.randn(1000,2)*[0.4,0.6]+[+1.,+1.],
                 np.random.randn(1000,2)*[0.7,0.3]+[-1.,-1.]])

def fcn(x):
    nsig = ((sig[:,0]>x[0]) & (sig[:,0]<x[1]) & (sig[:,1]>x[2]) & (sig[:,1]<x[3])).sum()
    nbkg = ((bkg[:,0]>x[0]) & (bkg[:,0]<x[1]) & (bkg[:,1]>x[2]) & (bkg[:,1]<x[3])).sum()
    if nsig+nbkg<1: return 0.
    return nsig/(nsig+nbkg)**0.5
    
def crossover(x,y):
    return [np.random.choice([v,w]) for v,w in zip(x,y)]
def mutation(x):
    return [v+np.random.randn()*0.2 if np.random.rand()<0.2 else v for v in x]

population = 50
chromo = [np.random.rand(4)*4.-2. for i in range(population)]
fitness = [fcn(x) for x in chromo]

print("Starting Evolution...")
for gen in range(20): # 20 Generations
    for idx in range(population):
        pick = np.random.randint(0,population,2)
        x = crossover(chromo[pick[0]],chromo[pick[1]])
        x = mutation(x)
        chromo.append(x)
        fitness.append(fcn(x))
        
    rank = (-np.array(fitness)).argsort()[:population]
    chromo = [chromo[i] for i in rank]
    fitness = [fitness[i] for i in rank]
    print('Gen:',gen+1,'Best Fitness =',fitness[0])

# Plotting Best Box
box = chromo[0]
plt.figure(figsize=(6, 6), dpi=80)
plt.scatter(sig[:,0],sig[:,1],c='red',alpha=0.5,s=10)
plt.scatter(bkg[:,0],bkg[:,1],c='black',alpha=0.5,s=10)
plt.plot([box[0],box[0],box[1],box[1],box[0]],[box[2],box[3],box[3],box[2],box[2]],lw=3,c='blue')
plt.show()`;


        const root = ReactDOM.createRoot(document.getElementById('code-01'));
        root.render(<CodeRunner filename="l205-example-01.py" initialCode={code01} />);

        ReactDOM.createRoot(document.getElementById('code-02')).render(<CodeRunner filename="l205-example-02.py" initialCode={code02} />);
        ReactDOM.createRoot(document.getElementById('code-03')).render(<CodeRunner filename="l205-example-03.py" initialCode={code03} />);
        ReactDOM.createRoot(document.getElementById('code-05')).render(<CodeRunner filename="l205-example-05.py" initialCode={code05} />);

        ReactDOM.createRoot(document.getElementById('code-06')).render(<CodeRunner filename="l205-example-06.py" initialCode={code06} />);
        ReactDOM.createRoot(document.getElementById('code-07')).render(<CodeRunner filename="l205-example-07.py" initialCode={code07} />);
        ReactDOM.createRoot(document.getElementById('code-09')).render(<CodeRunner filename="l205-example-09.py" initialCode={code09} />);

        ReactDOM.createRoot(document.getElementById('code-10b')).render(<CodeRunner filename="l205-example-10b.py" initialCode={code10b} />);
        ReactDOM.createRoot(document.getElementById('code-11a')).render(<CodeRunner filename="l205-example-11a.py" initialCode={code11a} />);
        ReactDOM.createRoot(document.getElementById('code-11b')).render(<CodeRunner filename="l205-example-11b.py" initialCode={code11b} />);

        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false }
            ]
        });
    </script>
</body>

</html>