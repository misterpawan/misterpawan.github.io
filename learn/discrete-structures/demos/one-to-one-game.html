<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Mapping Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Smooth transitions for interactive elements */
    .node-btn {
      transition: all 0.2s ease;
    }

    .node-btn:hover {
      transform: scale(1.1);
    }

    .selected {
      background-color: #2563eb !important;
      box-shadow: 0 0 0 4px #bfdbfe;
      transform: scale(1.1);
    }

    .mapped {
      opacity: 0.6;
    }

    /* Game Container Layout */
    #game-board {
      position: relative;
      width: 400px;
      height: 300px;
      margin: 0 auto;
    }

    /* SVG Layer needs to be on top but click-through */
    #lines-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    /* Columns for Set A and Set B */
    .column {
      position: absolute;
      display: flex;
      flex-direction: column;
      gap: 20px;
      z-index: 10;
    }

    #col-a {
      left: 40px;
      top: 20px;
    }

    #col-b {
      right: 40px;
      top: 20px;
    }
  </style>
</head>

<body class="bg-slate-100 font-sans text-slate-800 flex flex-col items-center justify-center min-h-screen p-4">

  <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-2xl">

    <div class="text-center mb-6">
      <h1 class="text-2xl font-bold mb-2">Function Mapping Challenge</h1>
      <span id="stage-badge"
        class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold">
        Stage 1: Create a One-to-One Map
      </span>
      <p id="instruction" class="text-slate-500 mt-2 text-sm">
        Connect every element in Set A to a <b>unique</b> element in Set B.
      </p>
    </div>

    <div id="game-board" class="bg-slate-50 rounded-lg border border-slate-200">
      <svg id="lines-layer">
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
          </marker>
        </defs>
      </svg>

      <div id="col-a" class="column"></div>
      <div id="col-b" class="column"></div>
    </div>

    <div id="feedback" class="mt-4 p-3 rounded-lg hidden text-center font-medium text-sm"></div>

    <div class="flex gap-4 mt-6">
      <button onclick="resetGame()"
        class="flex-1 px-4 py-2 border-2 border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50 font-bold">
        Reset
      </button>
      <button id="action-btn" onclick="checkSolution()"
        class="flex-[2] px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 font-bold transition-all">
        Check Answer
      </button>
    </div>

  </div>

  <script>
    // --- State Management ---
    const state = {
      stage: 1, // 1 = One-to-One, 2 = Not One-to-One
      mappings: {}, // { "0": "2", "1": "0" ... }  (Source Index -> Target Index)
      selectedSource: null,
      setSize: 4
    };

    // --- DOM Elements ---
    const colA = document.getElementById('col-a');
    const colB = document.getElementById('col-b');
    const svgLayer = document.getElementById('lines-layer');
    const feedbackEl = document.getElementById('feedback');
    const actionBtn = document.getElementById('action-btn');
    const badgeEl = document.getElementById('stage-badge');
    const instrEl = document.getElementById('instruction');

    // --- Initialization ---
    function initBoard() {
      colA.innerHTML = '';
      colB.innerHTML = '';

      // Create Buttons for Set A
      for (let i = 0; i < state.setSize; i++) {
        const btn = document.createElement('button');
        btn.className = 'node-btn w-12 h-12 rounded-full bg-blue-500 text-white font-bold shadow-md';
        btn.textContent = `A${i + 1}`;
        btn.onclick = () => handleSourceClick(i);
        btn.id = `btn-a-${i}`;
        colA.appendChild(btn);
      }

      // Create Buttons for Set B
      for (let i = 0; i < state.setSize; i++) {
        const btn = document.createElement('button');
        btn.className = 'node-btn w-12 h-12 rounded-full bg-emerald-500 text-white font-bold shadow-md';
        btn.textContent = `B${i + 1}`;
        btn.onclick = () => handleTargetClick(i);
        btn.id = `btn-b-${i}`;
        colB.appendChild(btn);
      }
      render();
    }

    // --- Interaction Handlers ---
    function handleSourceClick(index) {
      // Toggle selection
      if (state.selectedSource === index) {
        state.selectedSource = null;
      } else {
        // If this source already has a line, clear it
        if (state.mappings[index] !== undefined) {
          delete state.mappings[index];
        }
        state.selectedSource = index;
      }
      hideFeedback();
      render();
    }

    function handleTargetClick(index) {
      if (state.selectedSource === null) {
        showFeedback('error', 'Select a blue circle from Set A first!');
        return;
      }

      // Set mapping: Source -> Target
      state.mappings[state.selectedSource] = index;
      state.selectedSource = null; // Deselect after connecting
      hideFeedback();
      render();
    }

    // --- Rendering ---
    function render() {
      // 1. Update Buttons (Selection state)
      for (let i = 0; i < state.setSize; i++) {
        const btnA = document.getElementById(`btn-a-${i}`);

        // Reset classes
        btnA.className = 'node-btn w-12 h-12 rounded-full bg-blue-500 text-white font-bold shadow-md';

        // Apply 'Selected' style
        if (state.selectedSource === i) {
          btnA.classList.add('selected');
        }
        // Apply 'Mapped' opacity style
        else if (state.mappings[i] !== undefined) {
          btnA.classList.add('mapped');
        }
      }

      // 2. Draw Lines (SVG)
      // Remove old lines (keep definitions)
      const lines = svgLayer.querySelectorAll('line');
      lines.forEach(line => line.remove());

      Object.entries(state.mappings).forEach(([sourceIdx, targetIdx]) => {
        const yStart = 45 + (parseInt(sourceIdx) * 68); // Approximate center of button A
        const yEnd = 45 + (parseInt(targetIdx) * 68);   // Approximate center of button B

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', '65');  // Right edge of Col A
        line.setAttribute('y1', yStart);
        line.setAttribute('x2', '335'); // Left edge of Col B
        line.setAttribute('y2', yEnd);
        line.setAttribute('stroke', '#64748b');
        line.setAttribute('stroke-width', '3');
        line.setAttribute('marker-end', 'url(#arrowhead)');

        svgLayer.appendChild(line);
      });
    }

    // --- Game Logic ---
    function checkSolution() {
      const sources = Object.keys(state.mappings);
      const targets = Object.values(state.mappings);

      // Validation 1: Must be a function (all A's must map)
      if (sources.length < state.setSize) {
        showFeedback('error', 'Not complete! Every element in Set A needs an arrow.');
        return;
      }

      // Check if One-to-One (Unique targets)
      const uniqueTargets = new Set(targets);
      const isOneToOne = uniqueTargets.size === targets.length;

      if (state.stage === 1) {
        // Goal: One-to-One
        if (isOneToOne) {
          showFeedback('success', 'Correct! Every input has a unique output.');
          setButtonState('next');
        } else {
          showFeedback('error', 'Incorrect. Two arrows are pointing to the same circle in Set B.');
        }
      } else {
        // Goal: NOT One-to-One
        if (!isOneToOne) {
          showFeedback('success', 'Correct! This is a "Many-to-One" function.');
          setButtonState('finish');
        } else {
          showFeedback('error', 'Incorrect. This is still One-to-One. Try making two arrows point to the same B.');
        }
      }
    }

    function nextStage() {
      state.stage = 2;
      resetGame();
      badgeEl.innerText = 'Stage 2: Create a Map that is NOT One-to-One';
      badgeEl.className = 'inline-block px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-semibold';
      instrEl.innerText = 'Connect every element in A, but ensure at least two elements point to the same target.';
      setButtonState('check');
    }

    function resetGame() {
      state.mappings = {};
      state.selectedSource = null;
      hideFeedback();
      render();
      if (actionBtn.textContent === 'Finish') {
        // Hard reset if game finished
        location.reload();
      } else {
        setButtonState('check');
      }
    }

    // --- Helpers ---
    function showFeedback(type, msg) {
      feedbackEl.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');

      if (type === 'success') {
        feedbackEl.classList.add('bg-green-100', 'text-green-800');
      } else if (type === 'error') {
        feedbackEl.classList.add('bg-red-100', 'text-red-800');
      } else {
        feedbackEl.classList.add('bg-blue-100', 'text-blue-800');
      }
      feedbackEl.innerText = msg;
      feedbackEl.classList.remove('hidden');
    }

    function hideFeedback() {
      feedbackEl.classList.add('hidden');
    }

    function setButtonState(stateType) {
      if (stateType === 'next') {
        actionBtn.textContent = 'Next Challenge â†’';
        actionBtn.onclick = nextStage;
        actionBtn.classList.add('bg-blue-600', 'animate-pulse');
      } else if (stateType === 'finish') {
        actionBtn.textContent = 'Lesson Complete!';
        actionBtn.onclick = null;
        actionBtn.className = 'flex-[2] px-6 py-2 bg-green-600 text-white rounded-lg font-bold cursor-default';
      } else {
        actionBtn.textContent = 'Check Answer';
        actionBtn.onclick = checkSolution;
        actionBtn.classList.remove('bg-blue-600', 'animate-pulse', 'bg-green-600');
        actionBtn.classList.add('bg-slate-800');
      }
    }

    // Start the game
    initBoard();

  </script>
</body>

</html>