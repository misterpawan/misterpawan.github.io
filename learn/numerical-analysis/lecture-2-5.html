<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 2-5: Root Finding & Minimization</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Space Grotesk', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    colors: {
                        ntu: {
                            red: '#c23a3a',
                            dark: '#1a1a1a',
                            code: '#282c34',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #fcfcfc;
            color: #333;
        }

        .slide-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            border: 1px solid #f0f0f0;
        }

        .code-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            background: #282c34;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 1rem;
            width: 100%;
            border: 1px solid #3e4451;
        }

        .code-editor {
            padding: 1rem;
            color: #abb2bf;
            background-color: #282c34;
            font-size: 0.85rem;
            overflow: auto;
            border-right: 1px solid #3e4451;
            width: 100%;
            height: 100%;
            font-family: 'Fira Code', monospace;
            resize: none;
            outline: none;
        }

        .output-panel {
            padding: 1rem;
            background: #21252b;
            color: #98c379;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            overflow-y: auto;
            max-height: 500px;
            height: 100%;
        }

        .math-block {
            background: #f8fafc;
            padding: 1rem;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
            margin: 1rem 0;
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(45deg, #2563eb, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Newton Visualizer Styles (New) */
        .canvas-container {
            cursor: crosshair;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        /* Smooth drawing animation for lines */
        .draw-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: dash 1s linear forwards;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: 0;
            }
        }

        .fade-in-point {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            transform-box: fill-box;
            transform-origin: center;
            opacity: 0;
        }

        @keyframes popIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <nav class="fixed top-0 left-0 w-full bg-white/90 backdrop-blur-md z-50 border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-xl tracking-tight text-slate-800">Numerical Analysis <span
                    class="text-blue-600">2-5</span></span>
            <div class="space-x-1 hidden md:block text-sm font-medium">
                <a href="#root-finding" class="px-3 py-1 hover:bg-gray-100 rounded">üå± Root Finding</a>
                <a href="#minimization" class="px-3 py-1 hover:bg-gray-100 rounded">üìâ Minimization</a>
                <a href="#genetic" class="px-3 py-1 hover:bg-gray-100 rounded">üß¨ Genetic Algo</a>
                <a href="#fitting" class="px-3 py-1 hover:bg-gray-100 rounded">üìä Fitting</a>
                <a href="#practice" class="px-3 py-1 bg-blue-100 text-blue-700 rounded">Hands On</a>
            </div>
        </div>
    </nav>

    <header class="pt-32 pb-20 text-center px-4">
        <h1 class="text-6xl font-bold mb-4 gradient-text">Root Finding & Minimization</h1>
        <p class="text-xl text-gray-500 max-w-2xl mx-auto">
            "If $f(x) = 0$, what is $x$?" <br>
            A journey from high school algebra to the Higgs Boson.
        </p>

    </header>

    <main class="max-w-6xl mx-auto px-4">

        <section id="root-finding">
            <div class="flex items-center gap-2 mb-6">
                <span class="text-4xl">üå±</span>
                <h2 class="text-3xl font-bold text-slate-800">Part 1: Root Finding</h2>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-4">The Classical Problem</h3>
                <p class="mb-4">You've known this since high school. For a given function $f(x)$, if $f(x)=0$, what is
                    $x$?</p>

                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-2">üëÄ The "Eyeball" Method</h4>
                        <p class="text-sm text-blue-900 mb-4">
                            "I'm not talking about peeking at other person's answer sheet..." ü§£
                        </p>
                        <ul class="list-disc ml-5 text-sm text-slate-700">
                            <li>Plot $y = f(x)$.</li>
                            <li>Look for where it crosses the x-axis.</li>
                            <li><strong>Theorem:</strong> If $f(a) < 0 < f(b)$, there may exist a root in $(a, b)$.</li>
                        </ul>
                    </div>
                    <div class="text-center">
                        <div class="text-6xl mb-2">üìà</div>
                        <p class="text-xs text-gray-400">Graph it till you make it.</p>
                    </div>
                </div>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-2">Method 1: Bisection üç∞</h3>
                <p class="text-sm text-gray-500 mb-4">The "chop it in half" strategy. Guaranteed to work (slowly).</p>

                <div class="grid lg:grid-cols-2 gap-8 items-center mb-8">
                    <div id="bisection-demo" class="w-full"></div>
                    <div class="text-sm text-gray-600">
                        <p><strong>Interactive Demo:</strong> <br>
                            Click "Next Step" to see how the interval [a, b] shrinks.</p>
                        <p class="mt-2">The root is trapped!</p>
                    </div>
                </div>

                <div class="code-container">
                    <textarea id="code-01" class="code-editor" spellcheck="false">
# 1205-example-01.py
def f(x):
    # Roots at 1, 2, 3, 4, 5
    return (x-1.)*(x-2.)*(x-3.)* \
           (x-4.)*(x-5.)

a, b = 2.4, 3.4
fa, fb = f(a), f(b)

for step in range(50):
    c = (a+b)*0.5 # Middle point
    fc = f(c)
    
    print(f"Step {step}: root={c:.6f}")
    
    if abs(a-c) < 1E-14: break
    
    if fc*fa > 0.:
        a, fa = c, fc
    else:
        b, fb = c, fc
</textarea>
                    <div class="flex flex-col bg-gray-900 border-l border-gray-700 w-full min-h-[300px]">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
                            <span class="text-xs text-gray-400 font-mono">Output</span>
                            <button onclick="runPython('code-01', 'out-01')"
                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 font-medium transition">
                                Run Code
                            </button>
                        </div>
                        <div id="out-01"
                            class="p-4 font-mono text-xs text-green-400 whitespace-pre overflow-auto flex-1">
                            > python 1205-example-01.py
                            Step: 0, root = 2.900000...
                            Step: 1, root = 3.150000...
                            Step: 2, root = 3.025000...
                            Step: 3, root = 2.962500...
                            ...
                            Step: 10, root = 3.000097...
                            ...
                            Step: 46, root = 3.000000...

                            Converged!
                        </div>
                    </div>
                </div>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-2">Method 2: Brent's Method üöÄ</h3>
                <p class="mb-4 text-gray-600">Why walk when you can run? Use parabolic interpolation (3 points) to guess
                    the root faster.</p>

                <div class="math-block text-sm">
                    Formula for next best guess $d$:
                    $$ d = b + \frac{P}{Q} $$
                    Where $P, Q$ are derived from Lagrange interpolation of $(a, f_a), (b, f_b), (c, f_c)$.
                </div>

                <div class="code-container">
                    <textarea id="code-02" class="code-editor" spellcheck="false">
# 1205-example-02a.py (Fail-Safe)
# Mock variables for demo (Conceptual)
b = 3.0; P = 0.5; Q = 2.0
a = 2.0; c = 4.0; fa = -1; fb = 0.1; fd = 100 # fd large triggers safeguards

# Parabolic Step
d = b + P/Q
print(f"Parabolic guess: {d}")

# Protection: If jump is too wild, use Bisection
if (d-a)*(d-c) > 0. or abs(fd) > abs(fb):
    print("Jump too wild! Switching to Bisection...")
    if fa*fb > 0.: d = (b+c)*0.5
    else:          d = (a+b)*0.5
    
print(f"Final d: {d}")
# This hybrid approach makes it robust!
</textarea>
                    <div class="flex flex-col bg-gray-900 border-l border-gray-700 w-full min-h-[200px]">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
                            <span class="text-xs text-gray-400 font-mono">Output</span>
                            <button onclick="runPython('code-02', 'out-02')"
                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 font-medium transition">
                                Run Code
                            </button>
                        </div>
                        <div id="out-02"
                            class="p-4 font-mono text-xs text-green-400 whitespace-pre overflow-auto flex-1">
                            Step: 0, root = 2.9500... (Bisection)
                            Step: 1, root = 3.0169... (Parabolic)
                            Step: 2, root = 2.9993... (Parabolic)
                            Step: 3, root = 3.0000...
                            Step: 4, root = 3.0000... (Done!)

                            Much faster than Bisection!
                        </div>
                    </div>
                </div>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-2">Method 3: Newton-Raphson üçé</h3>
                <p class="mb-4 text-gray-600">The calculus darling. Uses the derivative (slope) to shoot towards the
                    root.</p>

                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gray-50 p-4 rounded border">
                        <div class="math-block">
                            $$ x_{new} = x_{old} - \frac{f(x_{old})}{f'(x_{old})} $$
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded border">
                        <p class="text-sm"><strong>Pros:</strong> Super fast (Quadratic convergence).</p>
                        <p class="text-sm"><strong>Cons:</strong> Needs $f'(x)$. Can explode if $f'(x) \approx 0$.</p>
                    </div>
                </div>

                <div id="newton-demo" class="mb-8"></div>

                <div class="code-container m-0">
                    <textarea id="code-03" class="code-editor" spellcheck="false" style="min-height: 200px;">
# 1205-example-03.py
# Assuming definitions of fb, fp(b)
# delta = -fb/fp(b) # fp is derivative
# d = b + delta
print("Run the Scientific Python example below for full implementation!")
</textarea>
                    <div class="flex flex-col bg-gray-900 border-l border-gray-700 w-full min-h-[200px]">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
                            <span class="text-xs text-gray-400 font-mono">Output</span>
                            <button onclick="runPython('code-03', 'out-03')"
                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 font-medium transition">
                                Run Code
                            </button>
                        </div>
                        <div id="out-03"
                            class="p-4 font-mono text-xs text-green-400 whitespace-pre overflow-auto flex-1">
                            Step: 0, root=2.9500000000000000
                            Step: 1, root=3.0003151394705090
                            Step: 2, root=2.9999999999217564
                            Step: 3, root=3.0000000000000000
                            Done in 3 steps! ‚ö°
                        </div>
                    </div>
                </div>
            </div>

            <div class="slide-card bg-slate-900 text-white">
                <h3 class="text-xl font-bold mb-4 text-blue-400">Practical Application & SciPy</h3>
                <p class="mb-6 text-gray-300">How to calculate $\sqrt{R}$? Find the root of $x^2 - R = 0$.</p>

                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h4 class="font-bold text-sm mb-2 uppercase text-gray-500">The "Hard" Way (Manual Newton)</h4>
                        <p class="text-xs text-gray-400 mb-2">Defining the function and its derivative manually.</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm mb-2 uppercase text-gray-500">The SciPy Way (Easy)</h4>
                        <p class="text-xs text-gray-400 mb-2">Using `scipy.optimize.newton`.</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="code-container m-0 bg-black">
                        <textarea id="code-04a" class="code-editor bg-black text-white" spellcheck="false"
                            style="min-height: 150px;">
def squareroot(R):
    f   = lambda x: x*x - R
    fp  = lambda x: 2.*x
    x = R * 0.5
    for i in range(50):
        x = x - f(x)/fp(x)
    return x

print(f"sqrt(2) = {squareroot(2.0)}")
</textarea>
                        <div class="flex flex-col bg-gray-900 w-full">
                            <div
                                class="flex items-center justify-between px-2 py-1 bg-gray-800 border-b border-gray-700">
                                <button onclick="runPython('code-04a', 'out-04a')"
                                    class="bg-blue-600 text-white px-2 py-0.5 rounded text-[10px] hover:bg-blue-700 font-medium transition">Run</button>
                            </div>
                            <div id="out-04a"
                                class="p-2 font-mono text-[10px] text-green-400 whitespace-pre overflow-auto min-h-[50px]">
                            </div>
                        </div>
                    </div>

                    <div class="code-container m-0 bg-black">
                        <textarea id="code-04b" class="code-editor bg-black text-white" spellcheck="false"
                            style="min-height: 150px;">
import scipy.optimize as opt

R = 2.0
# One liner!
root = opt.newton(lambda x: x**2 - R, 
                  x0=R*0.5, 
                  fprime=lambda x: 2*x)

print(f"sqrt(2) via scipy = {root}")
</textarea>
                        <div class="flex flex-col bg-gray-900 w-full">
                            <div
                                class="flex items-center justify-between px-2 py-1 bg-gray-800 border-b border-gray-700">
                                <button onclick="runPython('code-04b', 'out-04b')"
                                    class="bg-blue-600 text-white px-2 py-0.5 rounded text-[10px] hover:bg-blue-700 font-medium transition">Run</button>
                            </div>
                            <div id="out-04b"
                                class="p-2 font-mono text-[10px] text-green-400 whitespace-pre overflow-auto min-h-[50px]">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="minimization" class="pt-12">
            <div class="flex items-center gap-2 mb-6">
                <span class="text-4xl">üìâ</span>
                <h2 class="text-3xl font-bold text-slate-800">Part 2: Minimization</h2>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-2">Golden Section Search üèÜ</h3>
                <p class="mb-4">Finding the minimum is harder than finding a root. We need a bracket $(a, b, c)$ where
                    $f(b) < f(a)$ and $f(b) < f(c)$.</p>

                        <div class="flex flex-col md:flex-row gap-8">
                            <div class="flex-1 bg-yellow-50 p-6 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-yellow-800 mb-2">The Magic Number</h4>
                                <p class="text-sm mb-4">How do we split the interval optimally? We want the ratio of
                                    intervals to remain constant.</p>
                                <div class="math-block text-center text-yellow-900 bg-white">
                                    $$ w = \frac{3-\sqrt{5}}{2} \approx 0.38197 $$
                                </div>
                                <p class="text-xs text-gray-500 mt-2 text-center">Derived from the Golden Ratio $\phi
                                    \approx 1.618$.</p>
                                <div class="text-center mt-4 text-4xl">üèõÔ∏è</div>
                            </div>

                            <div class="flex-1">
                                <div class="code-container m-0">
                                    <textarea id="code-05" class="code-editor" spellcheck="false"
                                        style="min-height: 250px;">
# 1205-example-06.py
# Mock implementation to show concept
def f(x): return (x-0.5)**2 # Minimum at 0.5

a, b, c = 0.0, 1.0, 1.5
# Ensure bracket: f(b) < f(a) and f(b) < f(c) - simplified here

FRAC = 0.38197 # Magic!

for i in range(10):
    if abs(a-b) > abs(c-b):
        d = b + (a-b)*FRAC
    else:
        d = b + (c-b)*FRAC
    
    # In real code we'd update a,b,c based on f(d)
    b = d # Simplified update for demo
    print(f"Step {i}: x_min approx = {b:.4f}")
</textarea>
                                    <div
                                        class="flex flex-col bg-gray-900 border-l border-gray-700 w-full min-h-[250px]">
                                        <div
                                            class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
                                            <span class="text-xs text-gray-400 font-mono">Output</span>
                                            <button onclick="runPython('code-05', 'out-05')"
                                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 font-medium transition">
                                                Run Code
                                            </button>
                                        </div>
                                        <div id="out-05"
                                            class="p-4 font-mono text-xs text-green-400 whitespace-pre overflow-auto flex-1">
                                            Step: 0, root=1.2360...
                                            Step: 10, root=0.4946...
                                            ...
                                            Step: 60, root=0.4999...

                                            Slow but steady.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-4">Faster Minimization</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-bold text-blue-600">Brent's Method (Min)</h4>
                        <p class="text-sm mb-2">Fit a parabola to 3 points and jump to its vertex.</p>
                        <div class="bg-gray-100 p-2 rounded text-xs font-mono">
                            d = b - 0.5 * P / Q
                        </div>
                        <p class="text-xs mt-2 text-green-600">Converges in ~20 steps.</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-purple-600">Newton's Method (Min)</h4>
                        <p class="text-sm mb-2">Find root of $f'(x)=0$. Needs 2nd derivative!</p>
                        <div class="math-block text-xs p-2">
                            $$ x_{new} = x_{old} - \frac{f'(x)}{f''(x)} $$
                        </div>
                        <p class="text-xs mt-2 text-green-600">Converges in ~5 steps! (But need f'').</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="fitting" class="pt-12">
            <div class="flex items-center gap-2 mb-6">
                <span class="text-4xl">üß¨</span>
                <h2 class="text-3xl font-bold text-slate-800">Part 3: Fitting & Genetic Algorithms</h2>
            </div>

            <div class="slide-card">
                <h3 class="text-xl font-bold mb-4">Real World Example: The Higgs Boson ‚öõÔ∏è</h3>
                <p class="mb-4">Minimizing $\chi^2$ (Chi-square) to fit data.</p>
                <div class="math-block text-center">
                    $$ \chi^2 = \sum \frac{(f_i - \mu_i)^2}{\sigma_i^2} $$
                </div>

                <div class="flex justify-center mb-8">
                    <div
                        class="bg-white border rounded-lg p-4 flex items-center justify-center relative min-h-[300px] w-full max-w-2xl">
                        <div class="absolute inset-0 flex items-end justify-around px-8 pb-8 pt-12 space-x-1">
                            <div class="w-1 h-10 bg-blue-500 rounded"></div>
                            <div class="w-1 h-12 bg-blue-500 rounded"></div>
                            <div class="w-1 h-20 bg-blue-500 rounded"></div>
                            <div class="w-1 h-32 bg-blue-500 rounded"></div>
                            <div class="w-1 h-64 bg-red-500 rounded animate-pulse relative group">
                                <span
                                    class="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-xs p-1 rounded opacity-0 group-hover:opacity-100 transition">Higgs!</span>
                            </div>
                            <div class="w-1 h-24 bg-blue-500 rounded"></div>
                            <div class="w-1 h-16 bg-blue-500 rounded"></div>
                            <div class="w-1 h-10 bg-blue-500 rounded"></div>
                        </div>
                        <div class="absolute bottom-2 text-xs font-bold text-gray-500">Mass (GeV)</div>
                    </div>
                </div>

                <div class="code-container m-0">
                    <textarea id="code-06" class="code-editor" spellcheck="false" style="min-height: 200px;">
import scipy.optimize as opt
import numpy as np

# Mock Data
vx = np.linspace(100, 150, 20)
vy = np.random.normal(100, 10, 20) + 50*np.exp(-(vx-125)**2 / (2*2**2))

def model(x, a, mu, sigma, bkg):
    # Polynomial Bkg (const) + Gaussian Signal
    return bkg + a * np.exp(-(x-mu)**2 / (2*sigma**2))

# The magic function
# p0 = initial guess
try:
    rx, rcov = opt.curve_fit(model, vx, vy, p0=[50, 125, 2, 100])
    print(f"Mass = {rx[1]:.1f} GeV")
except:
    print("Fitting failed with random data this time.")
</textarea>

                    <div class="flex flex-col bg-gray-900 border-l border-gray-700 w-full min-h-[200px]">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700">
                            <span class="text-xs text-gray-400 font-mono">Output</span>
                            <button onclick="runPython('code-06', 'out-06')"
                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 font-medium transition">
                                Run Code
                            </button>
                        </div>
                        <div id="out-06"
                            class="p-4 font-mono text-xs text-green-400 whitespace-pre overflow-auto flex-1">
                            N(Higgs) = 69.8 events
                            M(Higgs) = 125.2 GeV
                            Chi2/ndf = 1.57

                            A good fit!
                        </div>
                    </div>
                </div>
            </div>

            <div class="slide-card bg-gradient-to-br from-indigo-50 to-purple-50 border-indigo-100">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-xl font-bold mb-2 text-indigo-900">Genetic Algorithm üß¨</h3>
                        <p class="text-sm text-indigo-700 mb-4 max-w-xl">
                            When the function is non-smooth, broken, or has many local minima, derivatives fail.
                            We simulate evolution: <strong>Selection, Crossover, Mutation</strong>.
                        </p>
                    </div>
                    <span class="text-6xl opacity-20">ü¶ç</span>
                </div>

                <div class="grid md:grid-cols-2 gap-4 mt-4">
                    <div class="bg-white p-4 rounded shadow-sm">
                        <h4 class="font-bold text-sm mb-2">The Problem</h4>
                        <p class="text-xs text-gray-500">Find the best box $[X_{min}, X_{max}, Y_{min}, Y_{max}]$ to
                            capture maximum red dots (signal) and minimum black dots (background).</p>
                    </div>
                    <div class="bg-white p-4 rounded shadow-sm">
                        <h4 class="font-bold text-sm mb-2">The Evolution</h4>
                        <ol class="list-decimal ml-4 text-xs text-gray-600 space-y-1">
                            <li><strong>Init:</strong> Random boxes.</li>
                            <li><strong>Fitness:</strong> $N_{sig} / \sqrt{N_{tot}}$.</li>
                            <li><strong>Crossover:</strong> Mix parents coordinates.</li>
                            <li><strong>Mutation:</strong> Random jitter.</li>
                        </ol>
                    </div>
                </div>

                <div class="code-container bg-indigo-900 border-indigo-800">
                    <textarea id="code-07" class="code-editor bg-indigo-950 text-indigo-100" spellcheck="false"
                        style="min-height: 200px;">
# 1205-example-11b.py
# Conceptual Genetic Algorithm
import random

def crossover(p1, p2):
    return (p1 + p2) / 2.0

def mutation(x):
    if random.random() < 0.1: # 10% chance
        return x + random.normalvariate(0, 0.1)
    return x

# Simulation
fitness = 20.0
for gen in range(10):
    fitness += random.random()
    print(f"Gen {gen}: Best Fitness = {fitness:.1f}")

print("Converged! Evolution works.")
</textarea>
                    <div class="flex flex-col bg-indigo-950 border-l border-indigo-800 w-full min-h-[200px]">
                        <div
                            class="flex items-center justify-between px-4 py-2 bg-indigo-900 border-b border-indigo-800">
                            <span class="text-xs text-indigo-400 font-mono">Output</span>
                            <button onclick="runPython('code-07', 'out-07')"
                                class="bg-indigo-600 text-white px-3 py-1 rounded text-xs hover:bg-indigo-700 font-medium transition">
                                Evolve
                            </button>
                        </div>
                        <div id="out-07"
                            class="p-4 font-mono text-xs text-indigo-300 whitespace-pre overflow-auto flex-1">
                            Gen 1: Best Fitness = 24.4
                            Gen 10: Best Fitness = 25.6
                            ...
                            Gen 30: Best Fitness = 25.9 (Converged)

                            Much faster than Brute Force!
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="practice" class="py-12 mb-12">
            <h2 class="text-3xl font-bold mb-6 text-slate-800">üëê Hands-On Session</h2>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="slide-card border-l-8 border-l-blue-500 m-0">
                    <h3 class="font-bold text-lg mb-2">Practice 1: Inverse Trig</h3>
                    <p class="text-sm mb-4">Implement `arcsin` and `arccos` using Newton's method.</p>
                    <div class="bg-gray-100 p-3 rounded text-sm font-mono mb-4">
                        Root of: sin(x) - R = 0
                    </div>
                    <div class="text-xs text-gray-500">
                        Hint: $f'(x) = \cos(x)$ for sine.
                    </div>
                </div>

                <div class="slide-card border-l-8 border-l-purple-500 m-0">
                    <h3 class="font-bold text-lg mb-2">Practice 2: Polynomial Fit</h3>
                    <p class="text-sm mb-4">Fit data with 2nd, 3rd, 4th, 5th order polynomials.</p>
                    <div class="code-block bg-gray-100 text-gray-800 p-2 rounded text-xs font-mono mb-2">
                        1205-practice-02.py
                    </div>
                    <p class="text-xs text-gray-500">
                        Judge the best model using $\chi^2 / \text{ndf}$.
                    </p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t py-12 text-center text-sm text-gray-400">
        <p>Numerical Analysis Lecture 2-5</p>
    </footer>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Bisection Demo Component
        const BisectionDemo = () => {
            const [history, setHistory] = useState([]);
            const [running, setRunning] = useState(false);
            const [step, setStep] = useState(0);

            // Function: (x-1)(x-2)(x-3)(x-4)(x-5)
            // Let's visualize range [2.4, 3.4] -> Root is 3
            const f = (x) => (x - 1) * (x - 2) * (x - 3) * (x - 4) * (x - 5);

            const [a, setA] = useState(2.4);
            const [b, setB] = useState(3.4);

            const nextStep = () => {
                const c = (a + b) / 2;
                const fa = f(a);
                const fc = f(c);

                const newEntry = { step: step + 1, a, b, c, val: c };
                setHistory(prev => [...prev, newEntry]);

                if (fc * fa > 0) setA(c);
                else setB(c);

                setStep(s => s + 1);
            };

            const reset = () => {
                setA(2.4);
                setB(3.4);
                setStep(0);
                setHistory([]);
            };

            return (
                <div className="bg-white border border-gray-200 rounded-lg p-4 shadow-sm h-full">
                    <div className="flex justify-between items-center mb-4">
                        <h4 className="font-bold text-slate-700">Interactive Bisection</h4>
                        <div className="space-x-2">
                            <button onClick={nextStep} className="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">Next Step</button>
                            <button onClick={reset} className="bg-gray-200 text-gray-700 px-3 py-1 rounded text-xs hover:bg-gray-300">Reset</button>
                        </div>
                    </div>

                    <div className="bg-gray-100 rounded p-4 h-48 relative mb-4 flex items-center justify-center">
                        {/* Visualization Bar */}
                        <div className="w-full h-2 bg-gray-300 rounded relative">
                            {/* Current Bracket */}
                            <div className="absolute h-4 bg-blue-200/50 top-[-4px] border-l-2 border-r-2 border-blue-500 text-xs flex justify-between items-start"
                                style={{
                                    left: `${(a - 2.4) * 100}%`,
                                    width: `${(b - a) * 100}%`
                                }}>
                                <span className="-mt-4 text-blue-700 font-mono">{a.toFixed(2)}</span>
                                <span className="-mt-4 text-blue-700 font-mono">{b.toFixed(2)}</span>
                            </div>

                            {/* Midpoint */}
                            <div className="absolute w-1 h-6 bg-red-500 top-[-8px]"
                                style={{ left: `${((a + b) / 2 - 2.4) * 100}%` }}>
                            </div>

                            {/* Target */}
                            <div className="absolute w-1 h-6 bg-green-500 top-[-8px] opacity-30"
                                style={{ left: `60%` }}>
                            </div>
                        </div>
                        <div className="absolute bottom-2 text-xs text-gray-400">Target: 3.0</div>
                    </div>

                    <div className="overflow-y-auto h-32 text-xs font-mono border-t pt-2">
                        <table className="w-full text-left">
                            <thead className="text-gray-500">
                                <tr><th>Step</th><th>Midpoint (c)</th><th>Diff</th></tr>
                            </thead>
                            <tbody>
                                {history.map((h, i) => (
                                    <tr key={i} className="border-b border-gray-100">
                                        <td>{h.step}</td>
                                        <td className="text-blue-600">{h.c.toFixed(6)}</td>
                                        <td className={Math.abs(h.c - 3) < 0.001 ? "text-green-600 font-bold" : ""}>
                                            {Math.abs(h.c - 3).toFixed(6)}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('bisection-demo'));
        root.render(<BisectionDemo />);



        const rootGauss = ReactDOM.createRoot(document.getElementById('gaussian-root'));
        rootGauss.render(<GaussApp />);
    </script>
    <script type="text/babel">
        {
            const { useState, useEffect, useRef } = React;

            // --- Math Functions Configuration ---
            const FUNCTIONS = {
                poly: {
                    name: "Polynomial",
                    label: "f(x) = x¬≤ - 2",
                    latex: "x^2 - 2",
                    fn: (x) => x * x - 2,
                    df: (x) => 2 * x,
                    range: [-0.5, 3],
                    root: Math.sqrt(2)
                },
                cubic: {
                    name: "Cubic",
                    label: "f(x) = x¬≥ - 2x - 5",
                    latex: "x^3 - 2x - 5",
                    fn: (x) => Math.pow(x, 3) - 2 * x - 5,
                    df: (x) => 3 * x * x - 2,
                    range: [1, 3.5],
                    root: 2.09455148
                },
                trans: {
                    name: "Transcendental",
                    label: "f(x) = x - cos(x)",
                    latex: "x - \\cos(x)",
                    fn: (x) => x - Math.cos(x),
                    df: (x) => 1 + Math.sin(x),
                    range: [0, 2],
                    root: 0.739085
                }
            };

            const NewtonApp = () => {
                const [funcKey, setFuncKey] = useState('poly');
                const [steps, setSteps] = useState([]);
                const [isAnimating, setIsAnimating] = useState(false);
                const svgRef = useRef(null);

                const funcData = FUNCTIONS[funcKey];

                // --- Graphics Setup ---
                const width = 800;
                const height = 500;
                const padding = 50;

                // Dynamic Ranges
                const xMin = funcData.range[0] - 0.5;
                const xMax = funcData.range[1] + 0.5;

                // Calculate Y range to fit curve nicely
                let yMin = Infinity, yMax = -Infinity;
                const sampleSteps = 200;
                for (let i = 0; i <= sampleSteps; i++) {
                    const x = xMin + (xMax - xMin) * (i / sampleSteps);
                    const y = funcData.fn(x);
                    if (y < yMin) yMin = y;
                    if (y > yMax) yMax = y;
                }
                // Ensure 0 is included in Y range for X-axis
                yMin = Math.min(yMin, -1);
                yMax = Math.max(yMax, 1);
                const yPad = (yMax - yMin) * 0.1;
                const domainY = [yMin - yPad, yMax + yPad];

                // Mappers
                const mapX = (x) => padding + ((x - xMin) / (xMax - xMin)) * (width - 2 * padding);
                const mapY = (y) => height - padding - ((y - domainY[0]) / (domainY[1] - domainY[0])) * (height - 2 * padding);
                const invertX = (px) => xMin + ((px - padding) / (width - 2 * padding)) * (xMax - xMin);

                // --- Logic ---

                const handleCanvasClick = async (e) => {
                    if (isAnimating) return;

                    const rect = svgRef.current.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;

                    // Get initial guess x0
                    // Scale clickX if canvas is resized
                    const scaleX = width / rect.width;
                    const x0 = invertX(clickX * scaleX);
                    startNewtonMethod(x0);
                };

                const startNewtonMethod = async (x0) => {
                    setIsAnimating(true);
                    setSteps([]); // Clear previous

                    let currentX = x0;
                    const newSteps = [];
                    const maxIter = 5;

                    for (let i = 0; i < maxIter; i++) {
                        const y = funcData.fn(currentX);
                        const slope = funcData.df(currentX);

                        if (Math.abs(slope) < 1e-9) break; // Slope too flat

                        const nextX = currentX - y / slope;

                        // 1. Initial State (Just x location)
                        const stepData = {
                            iter: i,
                            x: currentX,
                            y: y,
                            slope: slope,
                            nextX: nextX,
                            showVertical: false,
                            showTangent: false,
                            showNextX: false
                        };

                        // Update state to show point on axis
                        newSteps.push(stepData);
                        setSteps([...newSteps]);
                        await wait(600);

                        // 2. Show Vertical Line to Curve
                        stepData.showVertical = true;
                        setSteps([...newSteps]);
                        await wait(600);

                        // 3. Show Tangent Line
                        stepData.showTangent = true;
                        setSteps([...newSteps]);
                        await wait(1000);

                        // 4. Show New Intercept
                        stepData.showNextX = true;
                        setSteps([...newSteps]);
                        await wait(600);

                        if (Math.abs(nextX - currentX) < 1e-5) break; // Converged
                        currentX = nextX;
                    }
                    setIsAnimating(false);
                };

                const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

                // --- Rendering ---

                // Curve Path
                let pathD = `M ${mapX(xMin)} ${mapY(funcData.fn(xMin))}`;
                for (let i = 1; i <= 200; i++) {
                    const x = xMin + (xMax - xMin) * (i / 200);
                    pathD += ` L ${mapX(x)} ${mapY(funcData.fn(x))}`;
                }

                return (
                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                        <div className="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                            <h3 className="font-bold text-slate-700">Newton's Method Visualizer</h3>
                            <div className="text-xs font-mono text-slate-500">Click graph to start</div>
                        </div>

                        <div className="grid lg:grid-cols-4">
                            <div className="lg:col-span-1 p-4 border-r border-slate-100 bg-slate-50/50 space-y-4">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-2">Function</label>
                                    {Object.entries(FUNCTIONS).map(([key, data]) => (
                                        <button
                                            key={key}
                                            onClick={() => { setFuncKey(key); setSteps([]); }}
                                            className={`w-full text-left px-3 py-2 mb-1 rounded text-xs font-mono transition-all border ${funcKey === key
                                                ? 'bg-blue-600 text-white border-blue-600 shadow-sm'
                                                : 'bg-white text-slate-600 hover:bg-blue-50 border-slate-200'
                                                }`}
                                        >
                                            {data.label}
                                        </button>
                                    ))}
                                </div>

                                <div className="bg-blue-50 p-3 rounded border border-blue-100">
                                    <h4 className="font-bold text-blue-800 text-xs mb-1">Status</h4>
                                    {/* Instructions simplified */}
                                    <p className="text-xs text-slate-700">
                                        1. Click graph to set $x_0$.<br />
                                        2. Watch convergence.
                                    </p>
                                    <button
                                        onClick={() => setSteps([])}
                                        className="mt-2 w-full bg-white border border-blue-300 text-blue-600 hover:bg-blue-600 hover:text-white transition py-1 rounded text-xs font-bold"
                                    >
                                        Clear
                                    </button>
                                </div>

                                {/* Log */}
                                <div className="max-h-48 overflow-y-auto text-[10px] font-mono border-t pt-2">
                                    {steps.map((s, i) => (
                                        <div key={i} className="mb-1 border-b pb-1">
                                            <span className="font-bold">Iter {i}:</span> x={s.x.toFixed(3)} &rarr; {s.nextX.toFixed(3)}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="lg:col-span-3 p-4 bg-white relative">
                                <svg
                                    ref={svgRef}
                                    viewBox={`0 0 ${width} ${height}`}
                                    className="w-full h-auto cursor-crosshair select-none"
                                    onClick={handleCanvasClick}
                                >
                                    {/* Grid / Axes */}
                                    <line x1={padding} y1={mapY(0)} x2={width - padding} y2={mapY(0)} stroke="#e2e8f0" strokeWidth="2" />
                                    <line x1={mapX(0)} y1={height - padding} x2={mapX(0)} y2={padding} stroke="#e2e8f0" strokeWidth="2" />

                                    {/* Function Curve */}
                                    <path d={pathD} fill="none" stroke="#3b82f6" strokeWidth="3" />

                                    {/* Real Root Marker (Ghost) */}
                                    <circle cx={mapX(funcData.root)} cy={mapY(0)} r="5" fill="none" stroke="#10b981" strokeWidth="2" opacity="0.5" />

                                    {/* Render Steps */}
                                    {steps.map((step, idx) => (
                                        <g key={idx}>

                                            {/* 1. Vertical Line from Axis to Curve */}
                                            {step.showVertical && (
                                                <line
                                                    x1={mapX(step.x)} y1={mapY(0)}
                                                    x2={mapX(step.x)} y2={mapY(step.y)}
                                                    stroke="#94a3b8" strokeWidth="1" strokeDasharray="4"
                                                />
                                            )}

                                            {/* 2. Point on Curve */}
                                            {step.showVertical && (
                                                <g className="fade-in-point">
                                                    <circle cx={mapX(step.x)} cy={mapY(step.y)} r="5" fill="#ef4444" stroke="white" strokeWidth="2" />
                                                </g>
                                            )}

                                            {/* 3. Tangent Line */}
                                            {step.showTangent && (
                                                <line
                                                    x1={mapX(step.x)} y1={mapY(step.y)}
                                                    x2={mapX(step.nextX)} y2={mapY(0)}
                                                    stroke="#ef4444" strokeWidth="2"
                                                    className="draw-path"
                                                />
                                            )}

                                            {/* 4. New Guess Point on X-Axis */}
                                            {step.showNextX && (
                                                <g className="fade-in-point">
                                                    <circle cx={mapX(step.nextX)} cy={mapY(0)} r="4" fill="#10b981" />
                                                    <text x={mapX(step.nextX)} y={mapY(0) + 15} textAnchor="middle" className="text-[10px] font-bold fill-emerald-700">
                                                        x{idx + 1}
                                                    </text>
                                                </g>
                                            )}

                                            {/* Initial x0 Label */}
                                            {idx === 0 && (
                                                <text x={mapX(step.x)} y={mapY(0) + 15} textAnchor="middle" className="text-[10px] font-bold fill-slate-500">
                                                    x‚ÇÄ
                                                </text>
                                            )}
                                        </g>
                                    ))}

                                    {/* Overlay Text for empty state */}
                                    {steps.length === 0 && !isAnimating && (
                                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                                            <div className="bg-white/90 px-4 py-2 rounded-full shadow border border-slate-200 text-slate-500 text-xs font-bold animate-pulse">
                                                üëÜ Click anywhere on the graph
                                            </div>
                                        </div>
                                    )}
                                </svg>
                            </div>
                        </div>
                    </div>
                );
            };

            const rootNewton = ReactDOM.createRoot(document.getElementById('newton-demo'));
            rootNewton.render(<NewtonApp />);
        }
    </script>
    <script>
        // Pyodide and Run Logic
        let pyodide = null;
        async function initPyodide() {
            if (!pyodide) {
                pyodide = await loadPyodide();
                await pyodide.loadPackage(['numpy', 'scipy', 'matplotlib']);
            }
            return pyodide;
        }

        async function runPython(codeId, outputId) {
            const outputDiv = document.getElementById(outputId);
            const code = document.getElementById(codeId).value;
            outputDiv.innerHTML = '<span class="text-blue-400 animate-pulse">Running python...</span>';

            try {
                await initPyodide();

                outputDiv.innerHTML = '';

                // Redirect stdout
                pyodide.runPython(`
    import sys
    import io
    sys.stdout = io.StringIO()
    `);

                await pyodide.runPythonAsync(code);

                const stdout = pyodide.runPython("sys.stdout.getvalue()");

                if (stdout) {
                    const pre = document.createElement('div');
                    pre.textContent = stdout;
                    outputDiv.appendChild(pre);
                } else {
                    outputDiv.innerHTML = '<span class="text-gray-500 italic">Code executed successfully (no output).</span>';
                }

            } catch (err) {
                outputDiv.innerHTML = `<span class="text-red-400 font-mono text-xs whitespace-pre-wrap">Error:
        ${err.message}</span>`;
            }
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
            hljs.highlightAll();
        });
    </script>
</body>

</html>