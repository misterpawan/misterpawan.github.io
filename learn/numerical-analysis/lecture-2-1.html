<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 2-1: The Art of Numerical Analysis üé®</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ntu: {
                            red: '#e11d48',
                            blue: '#1e3a8a',
                            light: '#eff6ff',
                            accent: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['Segoe UI', 'sans-serif'],
                        mono: ['Consolas', 'Monaco', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .slide-card {
            background: white;
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }

        /* Editor & Output Styles */
        .editor-container {
            position: relative;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            margin-bottom: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .editor-wrapper {
            position: relative;
            min-height: 250px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            background-color: #ffffff;
        }

        .editor-wrapper textarea,
        .editor-wrapper pre {
            margin: 0;
            padding: 1rem;
            border: none;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            white-space: pre;
            overflow: auto;
            position: absolute;
            top: 0;
            left: 0;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            tab-size: 4;
        }

        .editor-wrapper textarea {
            z-index: 2;
            color: transparent;
            background: transparent;
            caret-color: #000;
            resize: none;
            outline: none;
        }

        .editor-wrapper pre {
            z-index: 1;
            background: transparent;
            pointer-events: none;
        }

        .run-bar {
            background: #f1f5f9;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .run-btn {
            background: #1e3a8a;
            color: white;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: 600;
            border: none;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .run-btn:hover {
            background: #1e40af;
        }

        .run-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .output-box {
            margin-top: 0.5rem;
            background: #ffffff;
            color: #334155;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            min-height: 100px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .output-img {
            max-width: 100%;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #e2e8f0;
        }

        .math-box {
            background: #eff6ff;
            border-left: 4px solid #1e3a8a;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 4px 4px 0;
            overflow-x: auto;
        }

        /* Teach Mode Styles */
        html.teach-mode-active {
            font-size: 200%;
        }

        body.teach-mode {
            overflow: hidden;
            background: black;
        }

        body.teach-mode nav,
        body.teach-mode header,
        body.teach-mode footer {
            display: none !important;
        }

        body.teach-mode main {
            max-width: none;
            padding: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.teach-mode .slide-card {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            border-radius: 0;
            padding: 4rem;
            z-index: 100;
            overflow-y: auto;
            align-content: center;
        }

        body.teach-mode .slide-card.active-slide {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .teach-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #e11d48;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(225, 29, 72, 0.4);
            cursor: pointer;
            z-index: 9999;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .teach-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(225, 29, 72, 0.5);
        }

        body.teach-mode .teach-btn {
            display: none;
        }
    </style>
</head>

<body class="antialiased">

    <button onclick="toggleTeachMode()" class="teach-btn">
        <span>üë®‚Äçüè´</span> Teach Mode
    </button>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <span class="font-bold text-xl text-slate-800">Numerical Analysis <span
                    class="text-ntu-blue">2-1</span></span>
            <div class="hidden md:flex space-x-1 text-sm font-medium text-slate-600">
                <a href="#intro" class="px-3 py-1 hover:bg-gray-100 rounded">Intro</a>
                <a href="#music" class="px-3 py-1 hover:bg-gray-100 rounded">Music</a>
                <a href="#errors" class="px-3 py-1 hover:bg-gray-100 rounded">Errors</a>
                <a href="#floating" class="px-3 py-1 hover:bg-gray-100 rounded">Floating Point</a>
                <a href="#pi" class="px-3 py-1 hover:bg-gray-100 rounded">Pi</a>
            </div>
        </div>
    </nav>

    <header class="pt-24 pb-16 text-center px-4 bg-gradient-to-b from-blue-50 to-transparent">
        <h1 class="text-5xl md:text-6xl font-extrabold text-slate-900 mb-6 tracking-tight">
            The Art of Numerical Analysis üé®
        </h1>
        <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-8">
            Why do we need numerical methods? <br>
            <span class="text-sm text-blue-600 font-mono">From Babylonian clay tablets to Spotify.</span>
        </p>
        <div class="flex justify-center gap-4 text-sm text-gray-500 font-mono">
            <span>Lecture 2-1</span>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20">

        <section id="intro" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">1. Introduction</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 2-3</span>
            </div>

            <h3 class="text-xl font-bold mb-4">What is Numerical Analysis?</h3>
            <p class="mb-4 text-gray-700">
                Numerical analysis is the study of algorithms that use numerical approximation (as
                opposed to general symbolic manipulations) for problems of mathematical analysis.
            </p>
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                <p class="italic text-yellow-800">
                    "This does not require a very precise calculation. Sometimes the key point is to
                    solve the problems with a (relatively) quick-and-dirty way, comparing to a full analytical
                    solution."
                </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mt-6">
                <div class="bg-gray-100 p-4 rounded">
                    <h4 class="font-bold mb-2">Historical Example: Babylonian Tablet</h4>
                    <img src="assets/baby.png" alt="Babylonian Tablet"
                        class="max-h-[50vh] w-auto object-contain mx-auto rounded mb-2 border border-gray-300">
                    <p class="text-sm mb-2">Dated 1800-1600 BC. Approximation of $\sqrt{2}$:</p>
                    <p class="font-mono text-center my-2 text-blue-700">$$1 + 24/60 + 51/60^2 + 10/60^3$$</p>
                    <p class="text-center font-bold">$= 1.41421296...$</p>
                </div>
                <div class="bg-gray-100 p-4 rounded">
                    <h4 class="font-bold mb-2">Modern Context</h4>
                    <p class="text-sm">
                        "The real speciality of computers is repetition." Your computer can perform boring
                        calculations millions of times. A smarter way provides quick and precise
                        results.
                    </p>
                </div>
            </div>
        </section>

        <section id="music" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">2. The Art of Music üéµ</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 6-12</span>
            </div>

            <p class="mb-4">Converting audio to sheet music involves analyzing frequencies.</p>

            <div class="mb-8">
                <h3 class="font-bold text-lg mb-2">Generating/Loading Audio (A440 Hz)</h3>
                <div id="code-01"></div>
            </div>

            <div class="mb-8">
                <h3 class="font-bold text-lg mb-2">Fourier Transform (Spectrum)</h3>
                <p class="text-sm text-gray-600 mb-2">We use the Fast Fourier Transform (FFT) to find the dominant
                    frequencies.</p>
                <div id="code-02"></div>
                <p class="text-sm mt-2 text-green-600 font-bold">Result: A sharp peak at 440 Hz is expected!</p>
            </div>
        </section>

        <section id="errors" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">3. Errors in Computation ‚ö†Ô∏è</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 24-26</span>
            </div>

            <h3 class="text-xl font-bold mb-4">The Calculator Experiment</h3>
            <p class="mb-4">
                If you pick a calculator, insert a number, and press $\sqrt{}$ many times, you reach "1".
                Then square it back... you might not get the original number.
            </p>
            <iframe src="calculator-experiment.html"
                class="w-full h-[500px] border-none rounded-lg shadow-sm bg-white mb-6"></iframe>

            <h3 class="text-xl font-bold mb-4">Types of Errors</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-red-50 p-4 rounded border border-red-100">
                    <h4 class="font-bold text-red-900">1. Blunders / Bugs</h4>
                    <p class="text-sm text-red-800">Typographical errors, wrong data files, human error.</p>
                </div>
                <div class="bg-purple-50 p-4 rounded border border-purple-100">
                    <h4 class="font-bold text-purple-900">2. Roundoff Errors</h4>
                    <p class="text-sm text-purple-800">Floating point numbers have finite precision.</p>
                </div>
            </div>
        </section>

        <section id="floating" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">4. Floating Point Arithmetic üíª</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 27-30</span>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold mb-4">IEEE 754 Standard</h3>
                <div class="bg-gray-800 text-white p-4 rounded font-mono text-sm text-center mb-4">
                    $$(-1)^{\text{sign}} \times 2^{\text{exponent}-1023} \times (1 + \sum_{i=1}^{52} b_{52-i} 2^{-i})$$
                </div>
                <img src="assets/ieee.jpg" alt="IEEE 754 Infographic"
                    class="w-full h-auto rounded-lg shadow-md border border-gray-200 mb-6">
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-bold mb-4">"The Spoon is Not Real"</h3>
                <p class="mb-2">Computers cannot represent 0.1 exactly.</p>
                <div id="code-04"></div>
            </div>
        </section>

        <section id="pi" class="slide-card">
            <div class="flex justify-between items-center border-b pb-4 mb-6">
                <h2 class="text-3xl font-bold text-ntu-blue">5. Calculating $\pi$ ü•ß</h2>
                <span class="bg-gray-100 px-3 py-1 rounded text-xs font-mono text-gray-500">Slides 32-37</span>
            </div>

            <p class="mb-4">Using polygon approximation. As the number of sides $N$ increases, precision SHOULD improve,
                but eventually degrades due to roundoff.</p>
            <div class="math-box text-sm bg-white mb-4">
                $$S' = \sqrt{2 - \sqrt{4 - S^2}} \quad \text{(Recursive formula)}$$
            </div>

            <div id="code-03"></div>

            <div class="bg-red-50 p-4 rounded mt-4 border border-red-200">
                <h4 class="font-bold text-red-900">What goes wrong?</h4>
                <p class="text-sm text-red-800">
                    For very large $N$, $S$ becomes very small. $4 - S^2$ hits the limit of double precision, causing
                    <strong>Catastrophic Cancellation</strong>.
                </p>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t py-12 text-center text-sm text-gray-400 mt-12">
        <p>Numerical Analysis Lecture 2-1</p>
    </footer>

    <script>
        // --- Teach Mode Logic ---
        let isTeachMode = false;
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide-card');

        function toggleTeachMode() {
            isTeachMode = !isTeachMode;
            document.body.classList.toggle('teach-mode');
            document.documentElement.classList.toggle('teach-mode-active');

            if (isTeachMode) {
                updateCurrentSlideFromScroll();
                enterFullscreen();
                showSlide(currentSlide);
            } else {
                exitFullscreen();
                slides[currentSlide].scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        }

        function enterFullscreen() {
            const el = document.documentElement;
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        }

        function exitFullscreen() {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active-slide', i === index);
            });
        }

        function nextSlide() {
            if (currentSlide < slides.length - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function updateCurrentSlideFromScroll() {
            let closestIndex = 0;
            let minDistance = Infinity;
            slides.forEach((slide, i) => {
                const rect = slide.getBoundingClientRect();
                const distance = Math.abs(rect.top);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestIndex = i;
                }
            });
            currentSlide = closestIndex;
        }

        document.addEventListener('keydown', (e) => {
            if (!isTeachMode) return;
            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'ArrowDown') nextSlide();
            else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prevSlide();
            else if (e.key === 'Escape') {
                if (isTeachMode) toggleTeachMode();
            }
        });

        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement && isTeachMode) toggleTeachMode();
        });


        // --- Pyodide Setup ---
        let pyodide = null;
        async function initPyodideEnvironment() {
            if (pyodide) return pyodide;
            pyodide = await loadPyodide();
            await pyodide.loadPackage(['numpy', 'matplotlib', 'scipy']);
            return pyodide;
        }

        async function runPythonCode(code) {
            await initPyodideEnvironment();
            const setupCode = `
import sys
import io
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
plt.close('all')
sys.stdout = io.StringIO()
sys.stderr = io.StringIO()
`;
            const cleanupCode = `
stdout_val = sys.stdout.getvalue()
stderr_val = sys.stdout.getvalue()
`;
            const plotSaver = `
import base64
buf = io.BytesIO()
if plt.get_fignums() and len(plt.gcf().axes) > 0:
    plt.savefig(buf, format='png', bbox_inches='tight')
    buf.seek(0)
    img_str = base64.b64encode(buf.read()).decode('UTF-8')
else:
    img_str = ""
img_str
`;
            try {
                await pyodide.runPythonAsync(setupCode + code + cleanupCode);
                const stdout = pyodide.runPython("stdout_val");
                const stderr = pyodide.runPython("stderr_val");
                const imgB64 = pyodide.runPython(plotSaver);
                return { stdout, stderr, image: imgB64 ? 'data:image/png;base64,' + imgB64 : null };
            } catch (err) {
                return { error: err.message };
            }
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CodeRunner = ({ id, filename, initialCode }) => {
            const [code, setCode] = useState(initialCode);
            const [output, setOutput] = useState("");
            const [imageSrc, setImageSrc] = useState(null);
            const [status, setStatus] = useState("idle");
            const textareaRef = useRef(null);
            const preRef = useRef(null);

            useEffect(() => {
                if (preRef.current) {
                    preRef.current.removeAttribute('data-highlighted');
                    hljs.highlightElement(preRef.current);
                }
            }, [code]);

            const handleRun = async () => {
                setStatus("running");
                setOutput("");
                setImageSrc(null);
                const result = await runPythonCode(code);
                if (result.error) {
                    setStatus("error");
                    setOutput(result.error);
                } else {
                    setStatus("success");
                    setOutput(result.stdout || (result.image ? "" : "Done (no output)"));
                    if (result.image) setImageSrc(result.image);
                }
            };

            const handleScroll = () => {
                if (textareaRef.current && preRef.current) {
                    preRef.current.scrollTop = textareaRef.current.scrollTop;
                    preRef.current.scrollLeft = textareaRef.current.scrollLeft;
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = e.target.selectionStart;
                    const end = e.target.selectionEnd;
                    setCode(code.substring(0, start) + "    " + code.substring(end));
                    setTimeout(() => { e.target.selectionStart = e.target.selectionEnd = start + 4; }, 0);
                }
            };

            return (
                <div className="mb-6">
                    <div className="editor-container">
                        <div className="run-bar">
                            <span className="text-xs font-mono text-gray-500 font-bold">{filename}</span>
                            <button onClick={handleRun} disabled={status === 'running'} className="run-btn">
                                {status === 'running' ? 'Running...' : '‚ñ∂ Run Code'}
                            </button>
                        </div>
                        <div className="editor-wrapper">
                            <textarea
                                ref={textareaRef}
                                value={code}
                                onChange={(e) => setCode(e.target.value)}
                                onScroll={handleScroll}
                                onKeyDown={handleKeyDown}
                                spellCheck="false"
                            />
                            <pre ref={preRef}><code className="language-python">{code}</code></pre>
                        </div>
                    </div>
                    <div className="output-box">
                        {status === 'idle' && <div className="text-gray-400 italic">Click run to start...</div>}
                        {status === 'running' && <div className="text-blue-500 animate-pulse">Running simulation...</div>}
                        {status === 'error' && <div className="text-red-500 font-bold">Error Traceback:</div>}
                        <div>{output}</div>
                        {imageSrc && <img src={imageSrc} className="output-img" />}
                    </div>
                </div>
            );
        };

        const code01 = `import scipy
import scipy.io.wavfile as wavfile
import matplotlib.pyplot as plt
import numpy as np

# Create a dummy wave file for the demo
rate = 44100
t = np.linspace(0., 1., rate, endpoint=False)
data = np.sin(2 * np.pi * 440 * t) * 30000 # 440 Hz sine wave
wavfile.write('Sine_wave_440.wav', rate, data.astype(np.int16))

# Read and plot
rate, data = wavfile.read('Sine_wave_440.wav')
t = np.linspace(0., 1., rate, endpoint=False)

plt.figure(figsize=(8,6), dpi=80)
plt.plot(t[:rate//100], data[:rate//100])
plt.xlabel('Time [sec]')
plt.ylabel('Amplitude')
plt.show()`;

        const code02 = `import scipy.fftpack as fftpack
import scipy.io.wavfile as wavfile
import matplotlib.pyplot as plt
import numpy as np
import os

# Ensure data exists 
if not os.path.exists('Sine_wave_440.wav'):
    rate = 44100
    t = np.linspace(0., 1., rate, endpoint=False)
    data = np.sin(2 * np.pi * 440 * t) * 30000
    wavfile.write('Sine_wave_440.wav', rate, data.astype(np.int16))

rate, data = wavfile.read('Sine_wave_440.wav')

# FFT Analysis
fft = abs(fftpack.fft(data[:rate]))
freqs = fftpack.fftfreq(rate, 1./rate)

plt.figure(figsize=(8,6), dpi=80)
plt.plot(freqs[:1200], np.log10(fft[:1200]))
plt.xlabel('Frequency [Hz]')
plt.ylabel('log10(Amplitude)')
plt.show()`;

        const code03 = `import math
nsides = 6
length = 1.
print("Polygon Approximation of Pi:")
for i in range(20):
    length = (2. - (4. - length**2)**0.5)**0.5
    nsides *= 2
    pi = length * nsides / 2.
    print(f"Sides: {nsides}, Pi ~ {pi:.16f}")`;

        const code04 = `print(f"0.1 + 0.2 - 0.3 = {0.1 + 0.2 - 0.3}")`;

        ReactDOM.createRoot(document.getElementById('code-01')).render(<CodeRunner filename="l201-example-01.py" initialCode={code01} />);
        ReactDOM.createRoot(document.getElementById('code-02')).render(<CodeRunner filename="l201-example-02.py" initialCode={code02} />);
        ReactDOM.createRoot(document.getElementById('code-03')).render(<CodeRunner filename="l201-example-03.py" initialCode={code03} />);
        ReactDOM.createRoot(document.getElementById('code-04')).render(<CodeRunner filename="l201-example-04.py" initialCode={code04} />);

        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false }
            ]
        });
    </script>
</body>

</html>